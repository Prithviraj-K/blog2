var jora=(()=>{var he=Object.defineProperty;var Gt=Object.getOwnPropertyDescriptor;var Ut=Object.getOwnPropertyNames;var Yt=Object.prototype.hasOwnProperty;var w=(t,e)=>{for(var r in e)he(t,r,{get:e[r],enumerable:!0})},Ht=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Ut(e))!Yt.call(t,o)&&o!==r&&he(t,o,{get:()=>e[o],enumerable:!(n=Gt(e,o))||n.enumerable});return t};var Vt=t=>Ht(he({},"__esModule",{value:!0}),t);var As={};w(As,{default:()=>ys});var ct="1.0.0-beta.7";var N=Object.hasOwn||((t,e)=>Object.hasOwnProperty.call(t,e)),Wt=Object.prototype.toString;function U(t,e){return e!==void 0&&(Array.isArray(e)?e.forEach(r=>t.add(r)):t.add(e)),t}function ge(t,e,r){t.has(e)?t.get(e).add(r):t.set(e,new Set([r]))}function ft(t,e){return t&&N(t,e)?t[e]:void 0}function v(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function R(t){return Wt.call(t)==="[object RegExp]"}function I(t){return t&&N(t,"length")&&isFinite(t.length)}function M(t){if(Array.isArray(t))return t.length>0;if(v(t)){for(let e in t)if(N(t,e))return!0;return!1}return Boolean(t)}var Jt=function(){return{yy:{},options:{ranges:!0},rules:[/^(?:\/\/.*?(?:\n|\r\n?|\u2028|\u2029|$)|\/\*(?:.|\s)*?(?:\*\/|$))/,/^\s+/,/^\//,/^<(?!=)/,/^/,(e,r)=>{if(e[0]!==(r==="template"?"}":"`"))return null;for(let n=1;n<e.length;n++){if(e[n]==="`")return n+1;if(e[n]==="$"&&e[n+1]==="{")return n+2;e[n]==="\\"&&n++}return null},(e,r)=>{if(e[0]!==(r==="template"?"}":"`"))return null;for(let n=1;n<e.length;n++){if(e[n]==="`")return n+1;if(e[n]==="$"&&e[n+1]==="{")return n+2;e[n]==="\\"&&n++}return null},/^/,/^\(/,/^\)/,/^\[/,/^\]/,/^\{/,/^\}/,/^(?:(true|false|null|undefined|Infinity|NaN)\b)/,/^and\b/,/^or\b/,/^has\s+no\b/,/^has\b/,/^in\b/,/^not\s+in\b/,/^not\b/,/^no\b/,/^(?:(asc|desc)(NA?|AN?)?\b)/,/^is\b/,/^if\b/,/^then\b/,/^else\b/,/^(?:(\d+\.|\.)?\d+([eE][-+]?\d+)?\b)/,/^0[xX][0-9a-fA-F]+/,/^(?:"(?:\\[\\"]|[^"])*")/,/^(?:'(?:\\[\\']|[^'])*')/,/^(?:\/(?:\\.|[^/])+\/[gimsu]*)/,/^(?:(?:[a-zA-Z_]|\\u[0-9a-fA-F]{4})(?:[a-zA-Z_$0-9]|\\u[0-9a-fA-F]{4})*)/,/^(?:\$(?:[a-zA-Z_]|\\u[0-9a-fA-F]{4})(?:[a-zA-Z_$0-9]|\\u[0-9a-fA-F]{4})*)/,/^@/,/^#/,/^\$\$/,/^\$/,/^=>/,/^<(?!=)/,/^=/,/^!=/,/^~=/,/^>=/,/^<=/,/^</,/^>/,/^\.\.\(/,/^\.\(/,/^\.\[/,/^\.\.\./,/^\.\./,/^\./,/^\?\?/,/^\?/,/^,/,/^:/,/^;/,/^\-/,/^\+/,/^\*/,/^\//,/^\%/,/^(?:\|)/,/^./,/^$/],conditions:{preventPrimitive:{rules:[0,1,2,3,4,5,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66],inclusive:!0},template:{rules:[6,7],inclusive:!1},INITIAL:{rules:[0,1,5,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66],inclusive:!0}},performAction(e,r,n,o){let i=o;switch(n){case 0:{e.commentRanges.push(r.yylloc.range);break}case 1:break;case 2:{return this.popState(),39;break}case 3:{return this.popState(),43;break}case 4:{this.done=!1,this.popState();break}case 5:{let a=r.yytext.endsWith("`")?"TEMPLATE":"TPL_START";return r.yytext=this.toStringLiteral(r.yytext,!0,1+Number(a!=="TEMPLATE")),a==="TEMPLATE"&&e.pps(),a;break}case 6:{let a=r.yytext.endsWith("`")?"TPL_END":"TPL_CONTINUE";return r.yytext=this.toStringLiteral(r.yytext,!0,1+Number(a!=="TPL_END")),this.popState(),a==="TPL_END"&&e.pps(),a;break}case 7:{this.parseError("Unexpected end of input");break}case 8:return 64;case 9:{return e.pps(),65;break}case 10:return 60;case 11:{return e.pps(),62;break}case 12:return 82;case 13:{if(this.bracketStack[this.bracketStack.length-1]!=="TPL_END")return e.pps(),83;this.unput("}"),this.begin("template");break}case 14:{return r.yytext=this.toLiteral(r.yytext),56;break}case 15:return 35;case 16:return 36;case 17:return 34;case 18:return 32;case 19:return 31;case 20:return 33;case 21:return 25;case 22:return 26;case 23:return 92;case 24:return 29;case 25:return"IF";case 26:return"THEN";case 27:return"ELSE";case 28:{return e.pps(),r.yytext=Number(r.yytext),54;break}case 29:{return e.pps(),r.yytext=parseInt(r.yytext,16),54;break}case 30:{return e.pps(),r.yytext=this.toStringLiteral(r.yytext),53;break}case 31:{return e.pps(),r.yytext=this.toStringLiteral(r.yytext),53;break}case 32:{return e.pps(),r.yytext=this.toRegExp(r.yytext),55;break}case 33:{return e.pps(),r.yytext=this.ident(r.yytext),14;break}case 34:{return e.pps(),r.yytext=this.ident(r.yytext.slice(1)),15;break}case 35:{return e.pps(),50;break}case 36:{return e.pps(),51;break}case 37:{return e.pps(),52;break}case 38:{return e.pps(),9;break}case 39:return 22;case 40:{return this.fnOpened++,20;break}case 41:return 41;case 42:return 42;case 43:return 47;case 44:return 46;case 45:return 44;case 46:return 43;case 47:return this.fnOpened?(this.fnOpened--,21):45;case 48:return 70;case 49:return 67;case 50:return 68;case 51:return 86;case 52:{return e.pps(),69;break}case 53:{return e.pps(),66;break}case 54:return 37;case 55:return 17;case 56:return 72;case 57:return 11;case 58:return 10;case 59:return 27;case 60:return 28;case 61:return 38;case 62:return 39;case 63:return 40;case 64:return 24;case 65:{this.parseError(`Bad input on line ${r.yylloc.first_line} column ${r.yylloc.first_column}
`+this.showPosition(),{text:r.yytext,token:"BAD_TOKEN"});break}case 66:return 5}},setInput(e,r){return this.yy=r||this.yy||{},this._input=e,this._more=!1,this._backtrack=!1,this.done=!1,this.currentCondition="INITIAL",this.conditionStack=["INITIAL"],this.offset=0,this.yytext=this.match="",this.yyleng=0,this.yylineno=0,this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.yylloc.range=[0,0],this},parseError(e,r){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,r)},input(){let e=this._input[this.offset],r=/\n|\r\n?|\u2028|\u2029/g.test(e);return this.offset++,this.yyleng++,this.yytext=this.match=this.yytext+e,r?(this.yylineno++,this.yylloc.last_line++,this.yylloc.last_column=0):this.yylloc.last_column++,this.yylloc.range[1]++,e},lineColumnForOffset(e=this.offset,r=this._input,n=1,o=0){let i=/\n|\r\n?|\u2028|\u2029/g,a=n,s=o,y=0,g;for(;(g=i.exec(r))!==null;)if(g.index<e)a++,s=0,y=g.index+g[0].length;else{s+=e-y,y=-1;break}return y!==-1&&(s+=e-y),{line:a,column:s}},setMatch(e,r){let n=this._input.slice(e,r),o=e!==this.offset?this.lineColumnForOffset(e):{line:this.yylloc.last_line,column:this.yylloc.last_column},i=e!==r?this.lineColumnForOffset(r-e,n,o.line,o.column):o;this.yytext=this.match=n,this.yyleng=r-e,this.offset=r,this.yylineno=i.line-1,this.yylloc={first_line:o.line,first_column:o.column,last_line:i.line,last_column:i.column},this.yylloc.range=[e,r]},less(e){let r=this.offset-this.match.length;this.setMatch(r,r+e)},unput(e){let r=this.match.length-e.length;if(!this.match.startsWith(e,r))throw new Error("Lexer#unput() should receive a part of matched text only");this.less(r)},more(){this._more=!0},reject(){throw new Error("reject() is allowed only when options.backtrack_lexer = true")},showPosition(e=this.offset-this.match.length){let r=this._input,n=Math.max(e-20,0),o=Math.min(e+20,r.length),i=(n===0?"":"...")+r.slice(n,e).replace(/\n|\r\n?|\u2028|\u2029/g,"\\n"),a=r.slice(e,o).replace(/\n|\r\n?|\u2028|\u2029/g,"\\n")+(o===r.length?"":"...");return i+a+`
${"-".repeat(i.length)}^`},test_match(e,r){let n;this._more=!1,this._backtrack=!1,this.setMatch(this.offset,this.offset+e[0].length),this.matches=e;let o=this.performAction.call(this,this.yy,this,r,this.conditionStack[this.conditionStack.length-1]);return!o&&this._backtrack?(Object.assign(this,n),!1):(this.eof()||(this.done=!1),typeof o=="number"&&this.yy.parser?this.yy.parser.terminals_[o]:o||!1)},eof(){return this.offset===this._input.length},next(){if(this.done)return 1;this.eof()&&(this.done=!0),this._more||(this.yytext="",this.match="");let e,r;for(let n of this.conditions[this.currentCondition].rules){let o=this.rules[n],i=this._input.slice(this.offset),a;if(typeof o=="function"){let s=o(i,this.currentCondition);switch(typeof s){case"string":a=[s];break;case"number":a=[i.slice(0,s)];break;default:a=s}}else a=i.match(o);if(a&&(!e||a[0].length>e[0].length)){e=a,r=n;break}}if(e)return this.test_match(e,r);if(this.eof())return 1;this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex(){let e;for(;!e;)e=this.next();return e},begin(e){this.currentCondition=e,this.conditionStack.push(e)},pushState(e){this.begin(e)},popState(){return this.conditionStack.pop(),this.currentCondition=this.conditionStack.length?this.conditionStack[this.conditionStack.length-1]:"INITIAL"},topState(e){return e=this.conditionStack.length-1-Math.abs(e||0),e>=0?this.conditionStack[e]:"INITIAL"},stateStackSize(){return this.conditionStack.length}}}();function ye(){this.yy={}}ye.prototype={Parser:ye,lexer:Jt,symbols_:{error:2,root:3,block:4,EOF:5,definitions:6,e:7,def:8,$:9,";":10,":":11,$ident:12,ident:13,IDENT:14,$IDENT:15,condConsequent:16,"?":17,condAlternate:18,query:19,FUNCTION_START:20,FUNCTION_END:21,FUNCTION:22,compareFunction:23,"|":24,NOT:25,NO:26,"-":27,"+":28,IS:29,assertion:30,IN:31,HAS:32,NOTIN:33,HASNO:34,AND:35,OR:36,"??":37,"*":38,"/":39,"%":40,"=":41,"!=":42,"<":43,"<=":44,">":45,">=":46,"~=":47,queryRoot:48,relativePath:49,"@":50,"#":51,$$:52,STRING:53,NUMBER:54,REGEXP:55,LITERAL:56,template:57,object:58,array:59,"[":60,sliceNotation:61,"]":62,"method()":63,"(":64,")":65,".":66,".(":67,".[":68,"..":69,"..(":70,arguments:71,",":72,templateString:73,templateStart:74,templateTail:75,templateEnd:76,templateContinue:77,TEMPLATE:78,TPL_START:79,TPL_CONTINUE:80,TPL_END:81,"{":82,"}":83,objectEntries:84,objectEntry:85,"...":86,arrayElements:87,arrayElement:88,assertionTerm:89,assertionList:90,compareExpr:91,ORDER:92,sliceNotationComponent:93,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",9:"$",10:";",11:":",14:"IDENT",15:"$IDENT",17:"?",20:"FUNCTION_START",21:"FUNCTION_END",22:"FUNCTION",24:"|",25:"NOT",26:"NO",27:"-",28:"+",29:"IS",31:"IN",32:"HAS",33:"NOTIN",34:"HASNO",35:"AND",36:"OR",37:"??",38:"*",39:"/",40:"%",41:"=",42:"!=",43:"<",44:"<=",45:">",46:">=",47:"~=",50:"@",51:"#",52:"$$",53:"STRING",54:"NUMBER",55:"REGEXP",56:"LITERAL",60:"[",62:"]",64:"(",65:")",66:".",67:".(",68:".[",69:"..",70:"..(",72:",",78:"TEMPLATE",79:"TPL_START",80:"TPL_CONTINUE",81:"TPL_END",82:"{",83:"}",86:"...",92:"ORDER"},productions_:[0,[3,2],[4,2],[4,1],[4,1],[4,0],[6,1],[6,2],[8,2],[8,4],[8,2],[8,4],[13,1],[12,1],[16,2],[16,1],[18,2],[18,1],[18,0],[7,1],[7,3],[7,2],[7,1],[7,3],[7,4],[7,2],[7,2],[7,2],[7,2],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[19,1],[19,1],[48,1],[48,1],[48,1],[48,1],[48,1],[48,1],[48,1],[48,1],[48,1],[48,1],[48,1],[48,1],[48,3],[48,2],[48,2],[48,1],[48,1],[48,3],[48,4],[48,2],[48,2],[48,3],[48,3],[48,2],[48,2],[48,3],[49,3],[49,4],[49,4],[49,3],[49,3],[49,4],[49,4],[49,3],[49,3],[49,4],[63,3],[63,4],[63,3],[63,4],[71,1],[71,3],[57,1],[57,2],[75,1],[75,2],[75,2],[75,3],[73,1],[74,1],[77,1],[76,1],[58,2],[58,3],[58,4],[58,3],[58,4],[58,5],[84,1],[84,3],[85,1],[85,1],[85,1],[85,3],[85,3],[85,3],[85,3],[85,3],[85,5],[85,1],[85,2],[87,1],[87,3],[88,1],[88,1],[88,2],[59,2],[59,3],[59,4],[30,1],[30,2],[30,3],[30,4],[89,1],[89,1],[89,1],[89,1],[90,1],[90,3],[90,3],[23,1],[23,3],[91,2],[61,1],[61,2],[61,2],[61,3],[93,1],[93,2]],table:function(e){function r(u){let k=u.match(/[\x20-\x2f]/g),B=k?Math.max(...k.map(c=>c.charCodeAt()-32)):-1;for(let c=B;c>=0;c--){let l=(32+c).toString(16),h;u=u.replace(new RegExp("\\[\\x"+l+"(.+?)\\]"),(p,d)=>h=d).replace(new RegExp("\\x"+l,"g"),h)}return u=u.replace(/<([^>]+?)>/g,(c,l)=>{let h=i[l[0]],p=1;return h>>5===1&&(h=h&31|i[l[1]]<<5,p=2),l.slice(p).repeat(h)}),u}function n(u){let k=[];for(let B=0;B<u.length;B++){let c=i[u[B]];if(c&32){let l=i[u[++B]];k.push(c&31|l<<5)}else k.push(c)}return k}let i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789~|=".split("").reduce((u,k,B)=>(u[k]=B,u),Object.create(null)),[a,s,...y]=e.split("=").map(r),g=s.split(";").map(u=>{let k=[];for(let B=0;B<u.length;B++)for(let c=0,l=i[u[B]];c<3;c++)k.push(l>>c*2&3);return k}),E=y.map(n),C=n(a).map(u=>{let k=g[u],B=Object.create(null);for(let c=0;c<k.length;c++){let l=k[c];if(l!==0){let h=E[l-1].shift();B[c]=l===1?h:[l-1,h]}}return B});for(let u=0;u<E[3].length;u+=2)C[E[3][u]][E[3][u+1]]=[3];return C}(`ABCDEFGHIJIIIIKLMMMN<KM>OPQRMSTUVTUMWXYNMZaEFSP<TI>QMbTUVTUcdMRIeeffFIFIgBhBMiBjBkBlBmBnBMMoBpB<FM>YgBqBrBRMsBt[ BhBRMt]BMMuBWMZMvBwBxByByBz<DB0>BI1B2B2BrBM<E3B>4B5Beff<D6B>7B7B<E8B>7BMM9<C >BMM~B|B|BMgChCMMiCjCjBkClCMpBmCnC2BMgCMqBMMMMWMMoCMvB<FI>pCqC2B<FM>FFMIMlBlCjCmCMPPMMMMxBxBzBMoCr<ECs>C0BhCMnCnCIMIsCsC=A1[ V[!C["lmkYoq]]]<GA>[#[$[%[&lqqVCJqK]U]['[(AKIAAE];]]A];Ag;AwU[)Clmkboq]<GA>[*lqqVy5qK]U'AwAA[+AkADCqo]<Fq>AAAAww<IA>g;AwADwzwP8|<GA>w||Az8|PAAP8[,[-w[.;AwA8A]][/wADD|8]]<F|>AAAAywqKDAwzAAw;AEV)<GA>#AE!<GA>#wA8A/<F|>AAAAzw|PCAwzAAw;AwAoA/<F|>AAAAzw|PDAwzAAw;AwAoA/<F|>AAAAz4|PDAwzAA,<F|>AAAAzw|PDAwzAA,<F|>AAAAz8|PDAwzAAw;AAEi"<GA>lqqVmJqKUAKIgFEB;AAAChCAAIAB<HA>gAAI<HA>Q;AwAsAwBDD|8<F|>AAAAzw|PDAwzAA,<F|>AAAAz4|PDAwzAAw;AA <GA>#AAAlC<PA>B;AE <GA>lqqVC5qKU'AE <GA>lqqVyJqKU'AAE!<GA>%VqKAAE;AARClC<LA>giAC<GA>gl;AwE~lmkbrq8<F|>*XA67AA0;AAADwzwM8|<GA>w||ADM|PAA|P;M;AAEi"<GA>lqqVmJqKU(B;<HA>C;AwA8+<Fq>AAAAzw|PDAwzAAg.0ADDqo6vqqqAAAAzw|PDAwzAA-0ADDv8|v6||AAAAzw|PDAwzAAw;AAE!<GA>lqqVCpqaU(<C;AAAAAAAAAAAAAAAAAAAAg>AAAC;AAAg<QA>w<KA>B;AAAgAkAACqo<Fq>AAAAwAAAD<FA>gB;<UA>wAAAD;AAEy"<GA>lqqVyJqKU'AAE!<GA>lqqVyJqKX'AAAChC<MA>gAAI<HA>Q;AAAChCAAIAB<HA>gAAI<HA>QB;<FA>kAACqo<Fq><FA>g<IA>g;AAU!<GA>$<VA>I;<VA>g;<FA>kAACqo<Fq><JA>UgCAAg;<YA>CAAg;AAQClC<LA>giAC<GA>gl;<YA>DAAw;AAAo<UA>DAAw;AAAg<UA>DAAw;AAAg;AAAClmEAAg<GA>&XAK4.kADDqo<Fq>AAAAzw|PDAwzAA-0ADDq8|vqqqAAAAzw|PDAwzAA-0ADDqo6rqqqAAAAzw|PDAwzAA-0ADDqoqrqqqAAAAzw|PDAwzAA-0ADDv8<F|>AAAAzw|PDAwzAA-0ADDq8|v6r6AAAAzw|PDAwzAA-0ADDq8|v6||AAAAzw|PDAwzAAw;AAAgAkAACqo<Fq>AAAAg<JA>gB;<FA>kAACqo<Fq><OA>g;AAAIAkAACqo<Fq><OA>g;<VA>gAAC;<FA>kAACqo<Fq><FA>wAAD<FA>g;AAE!<GA>lqqViJqKUAKIgEE;<UA>w;AAAwAkAACqo<Fq>AAAAw<JA>g;<FA>kAACqo<Fq>AAAAwAAAD<FA>g;<LA>gC<IA>g;<LA>wD<IA>w;AAAClC<LA>giAC<GA>gk;<FA>kAACqo<Fq>AAAAg<JA>g;<UA>CAqKDAAw;AAAIAkAACqo<Fq><IA>DAAwAAg;<FA>kAACqo<Fq><IA>DAAwAAg=B[ C[!D["E[#F[$P[%[&['[(hBgBGJQRbcd]iB]pBqB]S]]]]]x]ByB$oCw CzC%1CzC%2CzC%3CzC%4CzC%iDzC(~C[)iBpBqB]gDjDShDsDmDnDuDyDxD#1DzD0D2D!3D!1D4D5D6D!9DzC&7D8D~DSjEFmEnEiEkEtEzC%oCvEu"sDwEnDxEzC%yEzC%zEzC%0EzC%1EzC%2EzC%3EzC%4EzC%5EzC%6EzC%7EzC%8EzC%9EzC%~EzC%|EzC%gFzC%hFzC%iFzC%jFzC%kFmFzC(nF)ShD1DoFpFqF!rF!1DsFtFuF!oCxFzC&wF<EoC>yFzC%zF[*zC%2FzC']1FpBqBS6FoC7F8FzC%9FzC%sD~F[+sDhGnD]gGiG*kGpBqBSoCmGyB$oCqGrG[,9DzC&s]G8D~DSyBmEnEwGkE2GzC%zChBgB3GQRbcd)oCoC4GyB$<UoC>7F<EoC>kHzC&jHSlHoCoC+mHoCoC,H8D~DS[-wHnEuH]zHzC%0HzC%1HzC%2HzC%3[.HzC%oC]oC5.sD7HnDsD8HnD-<GoC>gIzC%hIzC%oCoC=[ [!O["[#[$[%tBTsBHIKLMN[&fUVWXYZae]]jB]['kBlBmBnBoBuBvB]]rB]]w]B![([)sBz[*B[+[,[-9B8B0B]1B2B3B4B]5B]6B[.7[/B~B|BgC]hCiCjCkClCmCnC]]]pC]qCrCsCtCuCvC!yC"0C<EyC">5C6C7C8C9CyCkD%|CjB'rBlDrDqDToDtDpDvDwD<C!tBT!>yC#gE|DrBlEtBToEpEqErEhEsEyC"(!rDqDToDtDpD<TyC">vDyCkD%lFjB'rBtBT<C!>tBT!vF(9CyC"<C,~B|BgChCiCjCkClCmCnC><C0/><CyC">yC$0F'rB3F4F5FkDkD(<CyC">rDqDTtD|FrDqDToDtDpDyC"yC$jG'rB)lGpC D9CnGoGwDpG)gE|DpCyC#gE|DrBuGtGlEtBToEpEqErEvGsE5C6C7CxGyGzG0G1GyC"yCtBTsB&jB'rB<Cs*>!<E-~B|BgChCiCjCkClCmCnC>,.+.,~B|BgChCiCjCkClCmCn<CC0B~B|Bg>C<D0B><C-~B|BgCjCkClCmC><F-~B|BgC>jCkClCmCkD)5GpC6GwD7G8GwD9G(~G(|G(gHhH(yC%iHjB'rBlDkD<C(>rDqDToDtDpDoHpHnHs*qHhH)rHpCyC#gE|DrBvHtBToEpEqErEtHsEyHxH<FyC">)4HpCqCrCsCtCuCvCs*yC"(oHpH6H<CrDqDToDtDpD>9HvHtBToEpEqErE~HsE|G<F(>|H(<CyC"><C(>=FDDDDEEEE<iBG><hBT>F<mBW><lB2B><lB4B><nByB><nBzB><nBuE><oBN><nB0B><nB1B><nB3B><nB5B><nB6B><nB7B><nB8B><nB9B><nB~B><nB|B><mBS><nBjC><nBkC>FFF<nB~C><dP><oBM><nBkD><elD>BCCCC<iBH><mBS><nBwE>FFF<QV><nB2B><nB4B><WZ><Wa><jBb><jBc><iBI><iBK><nBgE>xE9D9D7D7D1E1E~D~D<nBhC><nBjE><nBnE><nBoE><nBpE><nBqE><nBiC><dR><nBnC><nBoC><nBrC><nBsC><nB|C><nBgD><nBnD><emD><nBoD>uDu[ DwDwDxDxD]yDyD5D5D<SO><SX><nBd><ae><af><agB><ahB><ViB><UjB><WkB><jBlB><jBmB><mBnB><mBoB><mBpB><dqB><drB><hBsB><hBtB><hBuB><hBvB><dwB><nBxB><nBuC><nBxC><nByC><nB1C><nB2C><nBU><nBvE><nB6C>8C8C<nBgC><nBhE>yEzE2E2E|D|D<nBkE><DrE><SQ><nB4C><nBlC><nBpC><nBqC><nBtC><nBhD><nBiD><nBpD><nBrD>6D6D<SY><nBvC><nBwC><nBzC><nB0C><nB3C><iBJ><iBL><nB7C><nBiE>8D8D9D9D0<nBEl>E<nB5C><nBmC><nBjD><nBqD>vDv <nBsD>3D3DzDzD0D0D1D1D2D2D9C9C<nBmE><DsE><DtE><nBtD>3D3D4D4D=BB`),defaultActions:{48:[2,1],186:[2,146],229:[2,148]},performAction(t,e,r,n,o,i,a){let s=i.length-1;switch(o){case 1:return n.buildResult(i[s-1]);case 2:this.$={type:"Block",definitions:i[s-1],body:i[s],range:this._$.range};break;case 3:this.$={type:"Block",definitions:i[s],body:{type:"Placeholder",range:[a[s].range[1],a[s].range[1]]},range:this._$.range};break;case 4:this.$={type:"Block",definitions:[],body:i[s],range:this._$.range};break;case 5:this.$={type:"Block",definitions:[],body:{type:"Placeholder",range:[a[s].range[1],a[s].range[1]]},range:this._$.range};break;case 6:case 92:case 94:case 110:case 123:case 139:case 142:this.$=[i[s]];break;case 7:i[s-1].push(i[s]);break;case 8:this.$={type:"Definition",declarator:{type:"Declarator",name:null,range:a[s-1].range},value:null,range:this._$.range};break;case 9:this.$={type:"Definition",declarator:{type:"Declarator",name:null,range:a[s-3].range},value:i[s-1],range:this._$.range};break;case 10:this.$={type:"Definition",declarator:{type:"Declarator",name:i[s-1].name,range:a[s-1].range},value:null,range:this._$.range};break;case 11:this.$={type:"Definition",declarator:{type:"Declarator",name:i[s-3].name,range:a[s-3].range},value:i[s-1],range:this._$.range};break;case 12:case 13:case 135:case 136:this.$={type:"Identifier",name:i[s],range:this._$.range};break;case 14:case 16:case 150:this.$=i[s];break;case 15:case 17:case 18:case 149:this.$=null;break;case 19:case 50:case 51:case 62:case 63:case 125:break;case 20:this.$={type:"Function",arguments:[],body:i[s-1],legacy:!0,range:this._$.range};break;case 21:this.$={type:"Function",arguments:[],body:i[s],legacy:!1,range:this._$.range};break;case 22:this.$={type:"CompareFunction",compares:i[s],range:this._$.range};break;case 23:this.$={type:"Pipeline",left:i[s-2],right:i[s],range:this._$.range};break;case 24:this.$={type:"Pipeline",left:i[s-3],right:{type:"Block",definitions:i[s-1],body:i[s]},range:this._$.range};break;case 25:case 26:case 27:case 28:case 65:this.$={type:"Prefix",operator:i[s-1],argument:i[s],range:this._$.range};break;case 29:this.$={type:"Postfix",operator:i[s],argument:i[s-2],range:this._$.range};break;case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:this.$={type:"Binary",operator:i[s-1],left:i[s-2],right:i[s],range:this._$.range};break;case 49:this.$={type:"Conditional",test:i[s-2],consequent:i[s-1],alternate:i[s],range:this._$.range};break;case 52:this.$={type:"Data",range:this._$.range};break;case 53:this.$={type:"Context",range:this._$.range};break;case 54:this.$={type:"Current",range:this._$.range};break;case 55:this.$={type:"Arg1",range:this._$.range};break;case 56:this.$={type:"Reference",name:i[s],range:this._$.range};break;case 57:case 58:case 59:case 60:case 100:case 101:case 102:case 103:this.$={type:"Literal",value:i[s],range:this._$.range};break;case 61:this.$={type:"Template",values:i[s],range:this._$.range};break;case 64:this.$={type:"SliceNotation",value:null,arguments:i[s-1],range:this._$.range};break;case 66:this.$={type:"Conditional",test:null,consequent:i[s-1],alternate:i[s],range:this._$.range};break;case 67:case 71:this.$={type:"GetProperty",value:null,property:i[s],range:this._$.range};break;case 68:case 72:this.$={type:"MethodCall",value:null,method:i[s],range:this._$.range};break;case 69:this.$={type:"Parentheses",body:i[s-1],range:this._$.range};break;case 70:this.$={type:"Parentheses",body:{type:"Block",definitions:i[s-2],body:i[s-1]},range:this._$.range};break;case 73:this.$={type:"Map",value:null,query:i[s-1],range:this._$.range};break;case 74:this.$={type:"Filter",value:null,query:i[s-1],range:this._$.range};break;case 75:this.$={type:"MapRecursive",value:null,query:{type:"GetProperty",value:null,property:i[s]},range:this._$.range};break;case 76:this.$={type:"MapRecursive",value:null,query:{type:"MethodCall",value:null,method:i[s]},range:this._$.range};break;case 77:this.$={type:"MapRecursive",value:null,query:i[s-1],range:this._$.range};break;case 78:this.$={type:"Pick",value:i[s-2],getter:null,range:this._$.range};break;case 79:this.$={type:"Pick",value:i[s-3],getter:i[s-1],range:this._$.range};break;case 80:this.$={type:"SliceNotation",value:i[s-3],arguments:i[s-1],range:this._$.range};break;case 81:this.$={type:"GetProperty",value:i[s-2],property:i[s],range:this._$.range};break;case 82:this.$={type:"MethodCall",value:i[s-2],method:i[s],range:this._$.range};break;case 83:this.$={type:"Map",value:i[s-3],query:i[s-1],range:this._$.range};break;case 84:this.$={type:"Filter",value:i[s-3],query:i[s-1],range:this._$.range};break;case 85:this.$={type:"MapRecursive",value:i[s-2],query:{type:"GetProperty",value:null,property:i[s]},range:this._$.range};break;case 86:this.$={type:"MapRecursive",value:i[s-2],query:{type:"MethodCall",value:null,method:i[s]},range:this._$.range};break;case 87:this.$={type:"MapRecursive",value:i[s-3],query:i[s-1],range:this._$.range};break;case 88:this.$={type:"Method",reference:i[s-2],arguments:[],range:this._$.range};break;case 89:this.$={type:"Method",reference:i[s-3],arguments:i[s-1],range:this._$.range};break;case 90:this.$={type:"Method",reference:{type:"Reference",name:i[s-2]},arguments:[],range:this._$.range};break;case 91:this.$={type:"Method",reference:{type:"Reference",name:i[s-3]},arguments:i[s-1],range:this._$.range};break;case 93:case 111:case 124:case 143:i[s-2].push(i[s]);break;case 95:this.$=[i[s-1],...i[s]];break;case 96:case 145:this.$=[null,i[s]];break;case 97:case 147:this.$=[i[s-1],i[s]];break;case 98:this.$=[null,i[s-1],...i[s]];break;case 99:this.$=[i[s-2],i[s-1],...i[s]];break;case 104:case 107:this.$={type:"Object",properties:[],range:this._$.range};break;case 105:this.$={type:"Object",properties:i[s-1],range:this._$.range};break;case 106:this.$={type:"Object",properties:i[s-2],range:this._$.range};break;case 108:this.$={type:"Block",definitions:i[s-2],body:{type:"Object",properties:i[s-1]},range:this._$.range};break;case 109:this.$={type:"Block",definitions:i[s-3],body:{type:"Object",properties:i[s-2]},range:this._$.range};break;case 112:this.$={type:"ObjectEntry",key:{type:"Current"},value:null,range:this._$.range};break;case 113:this.$={type:"ObjectEntry",key:{type:"Reference",name:i[s]},value:null,range:this._$.range};break;case 114:this.$={type:"ObjectEntry",key:i[s],value:null,range:this._$.range};break;case 115:this.$={type:"ObjectEntry",key:i[s-2],value:i[s],range:this._$.range};break;case 116:case 117:case 118:this.$={type:"ObjectEntry",key:{type:"Literal",value:i[s-2]},value:i[s],range:this._$.range};break;case 119:this.$={type:"ObjectEntry",key:{type:"Identifier",name:"$"+i[s-2].name},value:i[s],range:this._$.range};break;case 120:this.$={type:"ObjectEntry",key:i[s-3],value:i[s],range:this._$.range};break;case 121:this.$={type:"Spread",query:null,array:!1,range:this._$.range};break;case 122:this.$={type:"Spread",query:i[s],array:!1,range:this._$.range};break;case 126:this.$={type:"Spread",query:null,array:!0,range:this._$.range};break;case 127:this.$={type:"Spread",query:i[s],array:!0,range:this._$.range};break;case 128:this.$={type:"Array",elements:[],range:this._$.range};break;case 129:this.$={type:"Array",elements:i[s-1],range:this._$.range};break;case 130:this.$={type:"Array",elements:i[s-2],range:this._$.range};break;case 131:this.$={type:"Assertion",negation:!1,assertion:i[s],range:this._$.range};break;case 132:this.$={type:"Assertion",negation:!0,assertion:i[s],range:this._$.range};break;case 133:this.$={type:"Assertion",negation:!1,assertion:i[s-1],range:this._$.range};break;case 134:this.$={type:"Assertion",negation:!0,assertion:i[s-1],range:this._$.range};break;case 137:this.$={type:"Method",reference:{type:"Reference",name:i[s]},arguments:[],range:this._$.range};break;case 138:this.$={type:"Identifier",name:String(i[s]),range:this._$.range};break;case 140:case 141:i[s-2].push(i[s-1],i[s]);break;case 144:this.$={type:"Compare",query:i[s-1],order:i[s],range:this._$.range};break;case 146:this.$=[null,i[s-1],i[s]];break;case 148:this.$=[i[s-2],i[s-1],i[s]];break}},trace(...t){this.DEBUG&&Jison.print(...t)},parseError(t,e){if(e.recoverable)this.trace(t);else{let r=new Error(t);throw r.hash=e,r}},parse(t,...e){let s=D=>{c.length-=2*D,l.length-=D,h.length-=D},y=()=>{let D=g.lex()||1;return typeof D!="number"&&(D=this.symbols_[D]||D),D},g=Object.create(this.lexer),E=g.options&&g.options.ranges,C={...this.yy,parser:this,lexer:g};g.setInput(t,C),typeof C.parseError=="function"&&(this.parseError=C.parseError),typeof g.yylloc>"u"&&(g.yylloc={});let u=this.table,k={},B=g.yylloc,c=[0],l=[null],h=[B],p=[],d="",f=0,b=0,A=0,m,S;for(;;){let D=c[c.length-1],T;if(this.defaultActions[D]?T=this.defaultActions[D]:((m===null||typeof m>"u")&&(m=y()),T=u[D]&&u[D][m]),!T||!T[0]){let ee=function(F){let L=c.length-1,pt=0;for(;;){if(2 .toString()in u[F])return pt;if(F===0||L<2)return!1;L-=2,F=c[L],++pt}},j,P="";if(!A){let F=[];for(let L in u[D])L in this.terminals_&&L>2&&F.push("'"+this.terminals_[L]+"'");P=g.showPosition?"Parse error on line "+(f+1)+`:
`+g.showPosition()+`
Expecting `+F.join(", ")+", got '"+(this.terminals_[m]||m)+"'":"Parse error on line "+(f+1)+": Unexpected "+(m===1?"end of input":"'"+(this.terminals_[m]||m)+"'"),this.parseError(P,{text:g.match,token:this.terminals_[m]||m,line:g.yylineno,loc:B,expected:F})}if(A===3){if(m===1||S===1)throw new Error(P||"Parsing halted while starting to recover from another error.");b=g.yyleng,d=g.yytext,f=g.yylineno,B=g.yylloc,m=y()}if(j===!1)throw new Error(P||"Parsing halted. No suitable error recovery rule available.");s(j),S=m==2?null:m,m=2,D=c[c.length-1],T=u[D]&&u[D][2],A=3}if(Array.isArray(T[0])&&T.length>1)throw new Error("Parse Error: multiple actions possible at state: "+D+", token: "+m);switch(T[0]){case 1:c.push(m),l.push(g.yytext),h.push(g.yylloc),c.push(T[1]),m=null,S?(m=S,S=null):(b=g.yyleng,d=g.yytext,f=g.yylineno,B=g.yylloc,A>0&&A--);break;case 2:{let j=this.productions_[T[1]][1],P=h[h.length-(j||1)],ee=h[h.length-1];k.$=l[l.length-j],k._$={first_line:P.first_line,last_line:ee.last_line,first_column:P.first_column,last_column:ee.last_column},E&&(k._$.range=[P.range[0],ee.range[1]]);let F=this.performAction.call(k,d,b,f,C,T[1],l,h,...e);if(typeof F<"u")return F;j&&s(j),c.push(this.productions_[T[1]][0]),l.push(k.$),h.push(k._$),c.push(u[c[c.length-2]][c[c.length-1]]);break}case 3:return!0}}}};var Kt=function(e){function r(p,d){Object.entries(d).forEach(([f,b])=>p[f]=b(p[f]))}let n=new Map([["EOF",["<end of input>"]],["IDENT",["ident"]],["$IDENT",["$ident"]],["FUNCTION_START",["'<'"]],["FUNCTION_END",["'>'"]],["FUNCTION",["'=>'"]],["NOT",["'not'"]],["NO",["'no'"]],["IS",["'is'"]],["THEN",["'then'"]],["ELSE",["'else'"]],["IN",["'in'"]],["HAS",["'has'"]],["NOTIN",["'not in'"]],["HASNO",["'has no'"]],["AND",["'and'"]],["OR",["'or'"]],["STRING",["string"]],["TPL_START",["template"]],["TEMPLATE",["template"]],["NUMBER",["number"]],["REGEXP",["regexp"]],["LITERAL",["'true'","'false'","'null'","'undefined'","'NaN'","'Infinity'"]],["ORDER",["'asc'","'desc'","'ascN'","'descN'"]]]),o=p=>n.get(p)||`'${p}'`,i=function(p,d={},f){if(d.recoverable)this.trace(p);else{if(Array.isArray(d.inside)){let D=f.lexer.offset-f.lexer.match.length;f.lexer.setMatch(D+d.inside[0],D+d.inside[1])}let b=f.lexer.yylloc,A=[p.split(/\n/)[0],"",f.lexer.showPosition()],m=Array.isArray(d.expected)?[...new Set([].concat(...d.expected.map(D=>o(D.slice(1,-1)))))]:null;m&&A.push("","Expecting "+m.join(", ")+" got "+o(d.token));let S=new SyntaxError(A.join(`
`));throw S.details={rawMessage:p,text:d.text,token:d.token,expected:m,loc:{range:b.range,start:{line:b.first_line,column:b.first_column,offset:b.range[0]},end:{line:b.last_line,column:b.last_column,offset:b.range[1]}}},S}},a=new Set([`
`,"\r","\u2028","\u2029"]),s=new Map([["undefined",void 0],["null",null],["false",!1],["true",!0],["Infinity",1/0],["NaN",NaN]]);Object.assign(e.lexer,{ident:p=>p.replace(/\\u[0-9a-fA-F]{4}/g,d=>String.fromCharCode(parseInt(d.slice(2),16))),toLiteral:p=>s.get(p),toStringLiteral(p,d=!1,f=1){let b=p.length-f,A="";for(let m=1;m<b;m++){if(!d&&a.has(p[m])&&this.parseError("Invalid line terminator",{inside:[m,m+1]}),p[m]!=="\\"){A+=p[m];continue}m===b-1&&this.parseError("Invalid backslash",{inside:[m,m+1]});let S=p[++m];switch(S){case"\r":m+=p[m+1]===`
`;break;case`
`:case"\u2028":case"\u2029":break;case"0":A+="\0";break;case"b":A+="\b";break;case"n":A+=`
`;break;case"r":A+="\r";break;case"f":A+="\f";break;case"t":A+="	";break;case"v":A+="\v";break;case"u":{let[D=""]=p.slice(m+1,m+5).match(/^[0-9a-f]*/i)||[];if(D.length===4){A+=String.fromCharCode(parseInt(D,16)),m+=4;break}this.parseError("Invalid Unicode escape sequence",{inside:[m-1,Math.min(m+1+D.length,b)]});break}case"x":{let[D=""]=p.slice(m+1,m+3).match(/^[0-9a-f]*/i)||[];if(D.length===2){A+=String.fromCharCode(parseInt(D,16)),m+=2;break}this.parseError("Invalid hexadecimal escape sequence",{inside:[m-1,Math.min(m+1+D.length,b)]});break}default:A+=S}}return A},toRegExp(p){let d=p.lastIndexOf("/")+1,f=p.substr(d);return f.split("").forEach((b,A,m)=>{let S=m.indexOf(b,A+1);S!==-1&&this.parseError("Duplicate flag in regexp",{inside:[d+S,d+S+1]})}),new RegExp(p.substr(1,p.lastIndexOf("/")-1),f)}}),r(e.lexer,{setInput:p=>function(d,f){let b=[];return f.commentRanges=b,f.buildResult=A=>({ast:A,commentRanges:b}),f.parseError=function(...A){return i.call(this,...A,f)},f.pps=()=>{this.eof()||this.begin("preventPrimitive")},this.fnOpened=0,this.fnOpenedStack=[],this.bracketStack=[],this.prevToken=null,this.prevYylloc={first_line:1,last_line:1,first_column:0,last_column:0,range:[0,0]},p.call(this,d,f)}});let y=new e.Parser;y.lexer={...e.lexer},y.yy={...e.yy};let g=["AND","OR","IN","NOTIN","HAS","HASNO","IS","THEN","ELSE"],E=[...g,"NOT","NO","ORDER"],C=["+","-","*","/","%","|","=","!=","~=",">=","<=","<",">"],u=[null,"?",":",";",",",".","..","(","[",".(","..(",".[","FUNCTION",...C,...g,"NOT","NO"],k=[",","?",":",";","EOF","]",")","}","TPL_CONTINUE","TPL_END",...C,...g,"ORDER"],B=new Map(u.map(p=>[p,new Set(k)]));for(let p of["(",".(","..("])B.get(p).delete(")");for(let p of["[",".["])B.get(p).delete("]");r(y.lexer,{lex:p=>function(){let f=this.offset,b=p.call(this);if(B.has(this.prevToken)&&B.get(this.prevToken).has(b)){let A={first_line:this.prevYylloc.last_line,last_line:this.yylloc.first_line,first_column:this.prevYylloc.last_column,last_column:this.yylloc.first_column,range:[this.prevYylloc.range[1],this.yylloc.range[0]]};if(this.unput(this.match),this.pushState("preventPrimitive"),this.done=!1,this.yytext="",this.yylloc=this.prevYylloc=A,f!==this.offset&&E.includes(b))switch(this._input[f]){case" ":case"	":A.last_column--,A.range[1]--;break;case`
`:{let m=this._input.lastIndexOf(`
`,f-1);A.last_line--,A.last_column=m===-1?A.last_column-1:f-m,A.range[1]--;break}}return this.prevToken="IDENT"}if(this.prevYylloc=this.yylloc,E.includes(b))switch(this._input[this.offset]){case" ":case"	":this.prevYylloc={...this.prevYylloc,last_column:this.prevYylloc.last_column+1,range:[this.prevYylloc.range[0],this.prevYylloc.range[1]+1]};break;case`
`:this.prevYylloc={...this.prevYylloc,last_line:this.prevYylloc.last_line+1,last_column:0,range:[this.prevYylloc.range[0],this.prevYylloc.range[1]+1]};break}return this.prevToken=b}});let c=new Map([["(",")"],[".(",")"],["..(",")"],["[","]"],[".[","]"],["{","}"],["TPL_START","TPL_END"]]),l=new Set([")","]","}","TPL_END"]),h=p=>function(){let f=p.call(this);if(l.has(f)){let b=this.bracketStack.pop();b!==f&&this.parseError(`Expected "${b}" got "${f}"`),this.fnOpened=this.fnOpenedStack.pop()||0}return c.has(f)&&(this.bracketStack.push(c.get(f)),this.fnOpenedStack.push(this.fnOpened),this.fnOpened=0),f};return r(e.lexer,{lex:h}),r(y.lexer,{lex:h}),{parse(p,d){return d?y.parse(p):e.parse(p)},*tokenize(p,d,f){let b=d?y:e,A=Object.create(b.lexer);for(A.setInput(p,{parser:b});!A.done;){let m={type:A.lex(),value:A.match,offset:A.yylloc.range[0]};f&&(m.loc={range:A.yylloc.range,start:{line:A.yylloc.first_line,column:A.yylloc.first_column},end:{line:A.yylloc.last_line,column:A.yylloc.last_column}}),yield m}}}}(new ye),te=Kt;var Ae={};w(Ae,{compile:()=>Qt,stringify:()=>Zt,walk:()=>Xt});function Qt(t,e){e.put(e.scope.arg1?"arguments[1]":"undefined")}function Xt(){}function Zt(t,e){e.put("$$")}var me={};w(me,{compile:()=>er,stringify:()=>rr,suggest:()=>$t,walk:()=>tr});function $t(t,e){t.elements.length===0&&e.queryRoot(t.range[0]+1,t.range[1]-1)}function er(t,e){e.put("["),e.list(t.elements,","),e.put("]")}function tr(t,e){e.list(t.elements)}function rr(t,e){e.put("["),e.list(t.elements,","),e.put("]")}var de={};w(de,{compile:()=>ir,stringify:()=>or,suggest:()=>nr,walk:()=>sr});function nr(t,e){Array.isArray(t.assertion)||(e.range(t.assertion.range,"var"),e.range(t.assertion.range,"assertion"))}function ir(t,e){if(Array.isArray(t.assertion)){e.put(t.negation?"!(":"(");for(let r=0;r<t.assertion.length;r++)if(r%2===0)e.node(t.assertion[r]);else switch(t.assertion[r]){case"and":e.put("&&");break;case"or":e.put("||");break;default:e.error("Bad conjuction operator in assertion",t)}e.put(")")}else switch(t.negation&&e.put("!"),t.assertion.type){case"Identifier":t.assertion.name?(e.put("!!"),e.tolerant&&e.put("(typeof "),e.put("a."),e.put(t.assertion.name),e.tolerant&&(e.put('==="function"?a.'),e.put(t.assertion.name)),e.put("("),e.nodeOrCurrent(),e.put(")"),e.tolerant&&e.put(":false)"),e.usedAssertions.has(t.assertion.name)?e.usedAssertions.get(t.assertion.name).push(t.assertion.range):e.usedAssertions.set(t.assertion.name,t.assertion.range)):e.put("false");break;case"Method":e.put("!!"),e.node(t.assertion);break;default:e.error('Unknown assertion node type "'+t.assertion.type+'"',t.assertion)}}function sr(t,e){if(Array.isArray(t.assertion))for(let r=0;r<t.assertion.length;r++)r%2===0&&e.node(t.assertion[r]);else e.node(t.assertion)}function or(t,e){if(t.negation&&e.put("not "),Array.isArray(t.assertion)){e.put("(");for(let r=0;r<t.assertion.length;r++)r%2===0?e.node(t.assertion[r]):(e.put(" "),e.put(t.assertion[r]),e.put(" "));e.put(")")}else e.node(t.assertion)}var be={};w(be,{compile:()=>lr,stringify:()=>pr,suggest:()=>ar,walk:()=>ur});var ht={in:"in","not in":"notIn",has:"has","has no":"hasNo",and:"and",or:"or","??":"nullish","+":"add","-":"sub","*":"mul","/":"div","%":"mod","=":"eq","!=":"ne","<":"lt","<=":"lte",">":"gt",">=":"gte","~=":"match"};function re(t,e,r){if(r.type==="Array"){if(r.elements.length===0){t.range([r.range[0]+1,r.range[1]-1],"value-subset",e,!1);return}let n=[];for(let{type:i,range:a,value:s}of r.elements)a&&(i==="Literal"||i==="Identifier")&&n.push(s);let o=n.length?t.literalList(n):!1;for(let{type:i,range:a,value:s}of r.elements)a&&(i==="Literal"||i==="Identifier"||i==="GetProperty"&&s===null)&&t.range(a,"value-subset",e,o)}}function ar(t,e){switch(t.operator){case"in":e.range(t.left.range,"in-value",t.right,null),re(e,t.left,t.right);break;case"not in":re(e,t.left,t.right);break;case"has":e.range(t.right.range,"in-value",t.left,null),re(e,t.right,t.left);break;case"has no":re(e,t.right,t.left);break;case"=":case"!=":e.range(t.right.range,"value",t.left,null);break}}function lr(t,e){if(!(t.operator in ht)){e.error('Unknown operator "'+t.operator+'"',t);return}switch(t.operator){case"and":e.put("!");case"or":{let r=e.allocateVar();e.put(`${e.buildinFn("bool")}(${r}=`),e.node(t.left),e.put(`)?${r}:`),e.scope.captureCurrent.disabled=!0,e.node(t.right),e.scope.captureCurrent.disabled=!1;break}case"??":{let r=e.allocateVar();e.put(`(${r}=`),e.node(t.left),e.put(`,${r}!==null&&${r}!==undefined)?${r}:`),e.scope.captureCurrent.disabled=!0,e.node(t.right),e.scope.captureCurrent.disabled=!1;break}case"has no":e.put("!");case"has":e.put(e.buildinFn("in")),e.put("("),e.node(t.right),e.put(","),e.node(t.left),e.put(")");break;default:e.put(e.buildinFn(ht[t.operator])),e.put("("),e.node(t.left),e.put(","),e.node(t.right),e.put(")")}}function ur(t,e){e.node(t.left),e.node(t.right)}function pr(t,e){e.node(t.left),/^[a-z]/i.test(t.operator)?(e.put(" "),e.put(t.operator),e.put(" ")):e.put(t.operator),e.node(t.right)}var ke={};w(ke,{compile:()=>fr,stringify:()=>gr,suggest:()=>cr,walk:()=>hr});function cr(t,e){t.body===null&&e.queryRoot(t.range[1])}function fr(t,e){t.definitions.length?e.createScope(()=>{e.put("(()=>{"),e.list(t.definitions),e.put("return "),e.nodeOrCurrent(t.body),e.put("})()")},(r,n)=>r+n+";"):t.body&&t.body.type==="Object"?(e.put("("),e.nodeOrCurrent(t.body),e.put(")")):e.nodeOrCurrent(t.body)}function hr(t,e){e.list(t.definitions),e.nodeOrNothing(t.body)}function gr(t,e){e.list(t.definitions),e.nodeOrNothing(t.body)}var Ce={};w(Ce,{compile:()=>yr,stringify:()=>mr,walk:()=>Ar});var gt={"":"cmp",N:"cmpNatural",A:"cmpAnalytical",NA:"cmpNaturalAnalytical",AN:"cmpNaturalAnalytical"};function yr(t,e){t.order.startsWith("desc")&&e.put("-"),e.createScope(()=>{let r=gt[t.order.slice(3+t.order.startsWith("desc"))]||gt[""];e.put(e.buildinFn(r)),e.put("((_q=$=>("),e.node(t.query),e.put("))(a),_q(b))")},(r,n)=>r+n+",")}function Ar(t,e){e.node(t.query)}function mr(t,e){e.node(t.query),e.put(" "),e.put(t.order)}var Ee={};w(Ee,{compile:()=>dr,stringify:()=>kr,walk:()=>br});function dr(t,e){e.put("(a, b)=>{let _q;return "),e.list(t.compares,"||"),e.put("||0}")}function br(t,e){e.list(t.compares)}function kr(t,e){e.list(t.compares,",")}var Be={};w(Be,{compile:()=>Cr,stringify:()=>Br,walk:()=>Er});function Cr(t,e){e.put(e.buildinFn("bool")),e.put("("),e.scope.captureCurrent.disabled=!0,e.nodeOrCurrent(t.test),e.put(")?"),e.nodeOrCurrent(t.consequent),e.put(":"),t.alternate?e.node(t.alternate):e.put("undefined"),e.scope.captureCurrent.disabled=!1}function Er(t,e){e.nodeOrNothing(t.test),e.nodeOrNothing(t.consequent),e.nodeOrNothing(t.alternate)}function Br(t,e){e.nodeOrNothing(t.test),e.put("?"),e.nodeOrNothing(t.consequent),t.alternate&&(e.put(":"),e.node(t.alternate))}var we={};w(we,{compile:()=>wr,stringify:()=>Sr,walk:()=>Dr});function wr(t,e){e.put("context")}function Dr(){}function Sr(t,e){e.put("#")}var De={};w(De,{compile:()=>Or,stringify:()=>Tr,suggest:()=>Nr,walk:()=>_r});function Nr(t,e){t.range&&e.range(t.range,"var")}function Or(t,e){e.put("$")}function _r(){}function Tr(t,e){e.put("$")}var Se={};w(Se,{compile:()=>vr,stringify:()=>qr,walk:()=>Mr});function vr(t,e){e.put("data")}function Mr(){}function qr(t,e){e.put("@")}var Ne={};w(Ne,{compile:()=>Fr,stringify:()=>Pr,walk:()=>Ir});function Fr(t,e){t.name&&e.put("$"+t.name)}function Ir(){}function Pr(t,e){e.put(t.name?"$"+t.name:"$")}var Oe={};w(Oe,{compile:()=>zr,stringify:()=>Lr,suggest:()=>xr,walk:()=>jr});function ne(t,e){return{type:"GetProperty",value:t,property:e}}function ie(t){return{type:"Identifier",name:t}}var Rr=["data","context","ctx","array","idx","index"];function xr(t,e){t.value===null&&e.range(t.declarator.range,"path")}function zr(t,e){if(t.declarator.name===null){e.node(t.declarator),e.nodeOrCurrent(t.value),e.put(";");return}if(e.scope.own.includes(t.declarator.name)){e.error(`Identifier "$${t.declarator.name}" has already been declared`,t.declarator);return}if(Rr.includes(t.declarator.name)){e.error(`Identifier "$${t.declarator.name}" is reserved for future use`,t.declarator);return}e.put("const "),e.node(t.declarator),e.put("="),e.node(t.value||ne(null,ie(t.declarator.name))),e.put(";"),e.scope.push(t.declarator.name),e.scope.own.push(t.declarator.name)}function jr(t,e){e.node(t.declarator),e.nodeOrNothing(t.value)}function Lr(t,e){e.node(t.declarator),t.value!==null&&(e.put(":"),e.node(t.value)),e.put(";")}var _e={};w(_e,{compile:()=>Gr,stringify:()=>Yr,walk:()=>Ur});function Gr(t,e){e.put(e.buildinFn("filter")),e.put("("),e.nodeOrCurrent(t.value),e.createScope(()=>{e.put(",$=>"),e.node(t.query)},(r,n)=>(e.put(")"),r+"("+n+",")),e.put(")")}function Ur(t,e){e.nodeOrNothing(t.value),e.node(t.query)}function Yr(t,e){e.nodeOrNothing(t.value),e.put(".["),e.node(t.query),e.put("]")}var Te={};w(Te,{compile:()=>Hr,stringify:()=>Wr,walk:()=>Vr});function Hr(t,e){e.createScope(()=>{e.scope.arg1=!0,e.put("function($){return "),e.node(t.body),e.put("}")},(r,n)=>r+n+",")}function Vr(t,e){e.node(t.body)}function Wr(t,e){t.legacy?(e.put("<"),e.node(t.body),e.put(">")):(e.put("=>"),e.node(t.body))}var ve={};w(ve,{compile:()=>Kr,stringify:()=>Xr,suggest:()=>Jr,walk:()=>Qr});function Jr(t,e){e.range(t.property.range,"path",t.value||void 0,!t.value),t.value===null&&e.range(t.property.range,"var"),t.range&&t.value===null&&t.property.range[0]!==t.range[0]&&e.queryRoot(t.range[0])}function Kr(t,e){e.put(e.buildinFn("map")),e.put("("),e.nodeOrCurrent(t.value),e.put(","),t.property.type==="Identifier"?e.put(JSON.stringify(t.property.name)):e.node(t.property),e.put(")")}function Qr(t,e){e.nodeOrNothing(t.value),e.node(t.property)}function Xr(t,e){e.nodeOrNothing(t.value)&&e.put("."),e.node(t.property)}var Me={};w(Me,{compile:()=>Zr,stringify:()=>en,walk:()=>$r});function Zr(t,e){e.put(t.name)}function $r(){}function en(t,e){e.put(t.name)}var qe={};w(qe,{compile:()=>tn,stringify:()=>nn,walk:()=>rn});function tn(t,e){e.put(typeof t.value=="string"?JSON.stringify(t.value):String(t.value))}function rn(){}function nn(t,e){e.put(typeof t.value=="string"?JSON.stringify(t.value):String(t.value))}var Fe={};w(Fe,{compile:()=>sn,stringify:()=>an,walk:()=>on});function sn(t,e){e.put(e.buildinFn("map")),e.put("("),e.nodeOrCurrent(t.value),e.createScope(()=>{e.put(",$=>"),e.node(t.query)},(r,n)=>(e.put(")"),r+"("+n+",")),e.put(")")}function on(t,e){e.nodeOrNothing(t.value),e.node(t.query)}function an(t,e){e.nodeOrNothing(t.value),e.put(".("),e.node(t.query),e.put(")")}var Ie={};w(Ie,{compile:()=>ln,stringify:()=>pn,walk:()=>un});function ln(t,e){e.put(e.buildinFn("mapRecursive")),e.put("("),e.nodeOrCurrent(t.value),e.createScope(()=>{e.put(",$=>"),e.node(t.query)},(r,n)=>(e.put(")"),r+"("+n+",")),e.put(")")}function un(t,e){e.nodeOrNothing(t.value),e.node(t.query)}function pn(t,e){e.nodeOrNothing(t.value),e.put(".."),e.isSimpleGetPropertyQuery(t.query)||e.isSimpleMethodCallQuery(t.query)?e.node(t.query):(e.put("("),e.node(t.query),e.put(")"))}var Pe={};w(Pe,{compile:()=>fn,stringify:()=>gn,suggest:()=>cn,walk:()=>hn});function cn(t,e){t.arguments.length===0&&e.queryRoot(t.range[1]-1)}function fn(t,e,r){e.tolerant&&e.put("(typeof "),t.reference.type==="Identifier"&&(e.usedMethods.has(t.reference.name)?e.usedMethods.get(t.reference.name).push(t.reference.range):e.usedMethods.set(t.reference.name,t.reference.range),e.put("m.")),e.node(t.reference),e.tolerant&&(e.put('==="function"?'),t.reference.type==="Identifier"&&e.put("m."),e.node(t.reference)),e.put("("),e.nodeOrCurrent(r),t.arguments.length&&(e.put(","),e.list(t.arguments,",")),e.put(")"),e.tolerant&&e.put(":undefined)")}function hn(t,e){e.node(t.reference),e.list(t.arguments)}function gn(t,e){e.node(t.reference),e.put("("),e.list(t.arguments,","),e.put(")")}var Re={};w(Re,{compile:()=>yn,stringify:()=>mn,walk:()=>An});function yn(t,e){e.node(t.method,t.value)}function An(t,e){e.nodeOrNothing(t.value),e.node(t.method)}function mn(t,e){e.nodeOrNothing(t.value)&&e.put("."),e.node(t.method)}var xe={};w(xe,{compile:()=>bn,stringify:()=>Cn,suggest:()=>dn,walk:()=>kn});function dn(t,e){t.properties.length===0&&e.queryRoot(t.range[0]+1,t.range[1]-1)}function bn(t,e){e.put("{"),e.list(t.properties,","),e.put("}")}function kn(t,e){e.list(t.properties)}function Cn(t,e){e.put("{"),e.list(t.properties,","),e.put("}")}var ze={};w(ze,{compile:()=>wn,stringify:()=>Sn,suggest:()=>Bn,walk:()=>Dn});var En=new Set(["Literal","Identifier","Reference","Current"]);function Bn(t,e){if(t.value===null)switch(t.key.type){case"Identifier":e.range(t.range,"path"),e.range(t.range,"var");break;case"Current":case"Reference":e.range(t.range,"var");break}}function wn(t,e){let r=t.value;switch(t.key.type){case"Current":return;case"Literal":e.node(t.key);break;case"Identifier":e.node(t.key),r=r||ne(null,ie(t.key.name));break;case"Reference":e.node(t.key.name),r=r||t.key;break;default:e.put("["),e.node(t.key),e.put("]")}e.put(":"),e.node(r)}function Dn(t,e){e.node(t.key),e.nodeOrNothing(t.value)}function Sn(t,e){if(En.has(t.key.type)){if(e.node(t.key),t.value===null)return}else e.put("["),e.node(t.key),e.put("]");e.put(":"),e.node(t.value)}var je={};w(je,{compile:()=>Nn,stringify:()=>_n,walk:()=>On});function Nn(t,e){e.put("("),e.node(t.body),e.put(")")}function On(t,e){e.node(t.body)}function _n(t,e){e.put("("),e.node(t.body),e.put(")")}var Le={};w(Le,{compile:()=>vn,stringify:()=>qn,suggest:()=>Tn,walk:()=>Mn});function Tn(t,e){if(t.getter===null){let r=t.range[1]-1;e.range([r,r],"key",t.value,!1),e.queryRoot(r)}else(t.getter.type==="GetProperty"||t.getter.type==="Reference"||t.getter.type==="Literal"&&typeof t.getter.value=="string")&&e.range(t.getter.range,"key",t.value,!1)}function vn(t,e){e.put(e.buildinFn("pick")),e.put("("),e.node(t.value),t.getter&&(e.put(","),e.node(t.getter)),e.put(")")}function Mn(t,e){e.node(t.value),t.getter!==null&&e.node(t.getter)}function qn(t,e){e.node(t.value),e.put("["),t.getter!==null&&e.node(t.getter),e.put("]")}var Ge={};w(Ge,{compile:()=>Fn,stringify:()=>Pn,walk:()=>In});function Fn(t,e){e.createScope(()=>{e.put("($=>("),e.node(t.right),e.put("))")},(r,n)=>r+n+","),e.put("("),e.node(t.left),e.put(")")}function In(t,e){e.node(t.left),e.node(t.right)}function Pn(t,e){e.node(t.left),e.put("|"),e.node(t.right)}var Ue={};w(Ue,{compile:()=>xn,stringify:()=>jn,suggest:()=>Rn,walk:()=>zn});function Rn(t,e){e.queryRoot(t.range[1])}function xn(t,e){e.put("$")}function zn(){}function jn(){}var Ye={};w(Ye,{compile:()=>Ln,stringify:()=>Un,walk:()=>Gn});function Ln(t,e){if(t.operator&&t.operator.type){e.createScope(()=>{e.put("($=>"),e.node(t.operator),e.put(")")},(r,n)=>r+n+";"),e.put("("),e.node(t.argument),e.put(")");return}switch(t.operator){default:e.error('Unknown operator "'+t.operator+'"',t)}}function Gn(t,e){e.node(t.argument),t.operator&&t.operator.type&&e.node(t.operator)}function Un(t,e){e.node(t.argument),e.put(" "),e.node(t.operator)}var He={};w(He,{compile:()=>Yn,stringify:()=>Vn,walk:()=>Hn});function Yn(t,e){switch(t.operator){case"no":case"not":e.put("!"),e.put(e.buildinFn("bool")),e.put("("),e.node(t.argument),e.put(")");break;case"+":case"-":e.put(t.operator),e.node(t.argument);break;case"is":e.put("!!("),e.node(t.argument),e.put(")");break;default:e.error('Unknown operator "'+t.operator+'"',t)}}function Hn(t,e){e.node(t.argument),t.operator&&t.operator.type&&e.node(t.operator)}function Vn(t,e){e.put(t.operator),t.operator!=="-"&&t.operator!=="+"&&e.put(" "),e.node(t.argument)}var Ve={};w(Ve,{compile:()=>Jn,stringify:()=>Qn,suggest:()=>Wn,walk:()=>Kn});function Wn(t,e){t.range&&e.range(t.range,"var")}function Jn(t,e){if(!e.scope.includes(t.name.name)&&e.tolerant){e.put("(typeof $"),e.node(t.name),e.put('!=="undefined"?$'),e.node(t.name),e.put(":undefined)");return}e.put("$"),e.node(t.name)}function Kn(t,e){e.node(t.name)}function Qn(t,e){e.put("$"),e.node(t.name)}var We={};w(We,{compile:()=>Xn,stringify:()=>$n,walk:()=>Zn});function Xn(t,e){e.put(e.buildinFn("slice")),e.put("("),e.nodeOrCurrent(t.value),t.arguments.slice(0,3).forEach(r=>{e.put(","),r?e.node(r):e.put("undefined")}),e.put(")")}function Zn(t,e){e.nodeOrNothing(t.value);for(let r of t.arguments.slice(0,3))r&&e.node(r)}function $n(t,e){let[r,n,o]=t.arguments;e.nodeOrNothing(t.value),e.put("["),r&&e.node(r),e.put(":"),n&&e.node(n),o&&(e.put(":"),e.node(o)),e.put("]")}var Je={};w(Je,{compile:()=>ti,stringify:()=>ni,suggest:()=>ei,walk:()=>ri});function ei(t,e){t.query===null&&e.queryRoot(t.range[1])}function ti(t,e){if(t.array){e.put("..."),e.put(e.buildinFn("ensureArray")),e.put("("),e.nodeOrCurrent(t.query),e.put(")");return}e.put("..."),e.nodeOrCurrent(t.query)}function ri(t,e){e.nodeOrNothing(t.query)}function ni(t,e){e.put("..."),e.nodeOrNothing(t.query)}var Ke={};w(Ke,{compile:()=>si,stringify:()=>ai,suggest:()=>ii,walk:()=>oi});function ii(t,e){for(let[r,n]of Object.entries(t.values))n===null&&e.queryRoot(t.values[Number(r)-1].range[1])}function si(t,e){for(let[r,n]of Object.entries(t.values)){let o=Number(r);n!==null&&(o!==0&&e.put("+"),o%2===0?e.put('"'+yt(n.value,li)+'"'):(e.put("("),e.node(n),e.put(")")))}}function oi(t,e){for(let r of t.values)r!==null&&e.node(r)}function ai(t,e){let r=t.values.length-1;for(let[n,o]of Object.entries(t.values)){let i=Number(n);i%2===0?(e.put(i===0?"`":"}"),e.put(yt(o.value,ui)),e.put(i===r?"`":"${")):o!==null&&e.node(o)}}var li=new Map([["\b","\\b"],[`
`,"\\n"],["\r","\\r"],["\f","\\f"],["	","\\t"],["\v","\\v"],["\u2028","\\u2028"],["\u2029","\\u2029"],["\\","\\\\"],['"','\\"']]),ui=new Map([["\b","\\b"],["\f","\\f"],["	","\\t"],["\v","\\v"],["\\","\\\\"],["$","\\$"]]);function yt(t,e){let r="";for(let n=0;n<t.length;n++)r+=e.get(t[n])||t[n];return r}var pi={Arg1:Ae,Array:me,Assertion:de,Binary:be,Block:ke,Compare:Ce,Conditional:Be,Context:we,Current:De,Data:Se,Declarator:Ne,Definition:Oe,Filter:_e,Function:Te,GetProperty:ve,Identifier:Me,Literal:qe,Map:Fe,MapRecursive:Ie,Method:Pe,MethodCall:Re,Object:xe,ObjectEntry:ze,Parentheses:je,Pick:Le,Pipeline:Ge,Placeholder:Ue,Postfix:Ye,Prefix:He,Reference:Ve,SliceNotation:We,CompareFunction:Ee,Spread:Je,Template:Ke},J=t=>new Map(Object.entries(pi).map(([e,r])=>[e,r[t]]).filter(([,e])=>typeof e=="function")),ci={};J("build").forEach((t,e)=>ci[e]=t);var Qe=J("compile"),Xe=J("walk"),Ze=J("stringify"),$e=J("suggest");function K(t,e){function r(a){if(Xe.has(a.type))o(a),Xe.get(a.type)(a,n),i(a);else throw new Error('Unknown node type "'+a.type+'"')}let n={node:r,nodeOrNothing(a){a!==null&&r(a)},list(a){a.forEach(r)}},o=()=>{},i=()=>{};typeof e=="function"&&(e={enter:e}),e&&(typeof e.enter=="function"&&(o=e.enter),typeof e.leave=="function"&&(i=e.leave)),r(t)}function At(t,e){return e>=0&&e<t.length&&/[a-zA-Z_$0-9]/.test(t[e])}function et(t,e){let r=t.charCodeAt(e);return r===9||r===10||r===13||r===32}function fi(t,e,r){for(;e<r;e++)if(!et(t,e))return!1;return!0}function hi(t,e,r,n,o){let i=[];for(let a=0;a<n.length;a++){let[s,y]=n[a];if(s>=e)break;s<t||(i.push(t,s),t=y)}return(t!==r.length||!o)&&i.push(t,e),i}function gi(t,e,r,n){let o=[];for(let i=0;i<t.length;i++){let[a,s,y,g]=t[i];if(fi(e,a,s)){for(;a>=0&&et(e,a-1);)a--;for(;s<e.length&&et(e,s);)s++;if(At(e,a-1)){if(a===s)continue;a++}if(At(e,s)){if(a===s)continue;s--}}let E=hi(a,s,e,r,n);for(let C=0;C<E.length;C+=2)o.push([E[C],E[C+1],y,g])}return o}function yi(t){let e=null,r=[],n=Object.assign(new Map,{literalList:r}),o=(a,s)=>{n.has(a)?n.get(a).push(s):n.set(a,[s])},i={range(a,s,y=e,g=!0){o(y,[...a,s,g])},literalList(a){let s="l"+r.length;return r.push([s,a]),s},queryRoot(a,s=a){o(e,[a,s,"var",!0]),o(e,[a,s,"path",!0])}};return K(t,a=>{if($e.has(a.type)){let s=e;e=a,$e.get(a.type)(a,i),e=s}}),n}function se(t,{ast:e,commentRanges:r}){let n=yi(e),o=r.length&&r[r.length-1][1]===t.length&&!/[\r\n]$/.test(t);for(let[i,a]of n)n.set(i,gi(a,t,r,o));return n}function Ai(t){return t.type==="GetProperty"}function mi(t){return t.type==="MethodCall"}function oe(t){function e(o){if(Ze.has(o.type))Ze.get(o.type)(o,n);else throw new Error('Unknown node type "'+o.type+'"')}let r=[],n={isSimpleGetPropertyQuery:Ai,isSimpleMethodCallQuery:mi,put(o){r.push(o)},node:e,nodeOrNothing(o){if(o!==null)return e(o),!0},list(o,i){if(!i){o.forEach(e);return}o.forEach((a,s)=>{s>0&&n.put(i),e(a)})}};return e(t),r.join("")}function tt(t,e,r){let n=Object.assign(Object.create(SyntaxError.prototype),r),o=new Error;return n.name=t,n.message=e,Object.defineProperty(n,"stack",{get:function(){return(o.stack||"").replace(/^(.+\n){1,3}/,t+": "+e+`
`)}}),n}function ae(t,e=!1,r=null){function n(l){let h="s"+y.length;return y.push(l?[h,l]:[h]),h}function o(l){let h=g.get(l);return h||g.set(l,h=n()),h}function i(l,h,p,d,f){let b=[l,h,JSON.stringify(p)];if(p==="var"){if(!c.scope.length)return;b.push(JSON.stringify(c.scope))}else d||(d=n()),b.push(d),f&&b.push(typeof f=="string"?f:o(f));return C.push(b),d}function a(l,h){let p=c.scope,d=u.length;if(c.scope=c.scope.slice(),c.scope.own=[],c.scope.firstCurrent=null,c.scope.captureCurrent=[],c.scope.arg1=p.arg1||!1,l(),c.scope.captureCurrent.length){let f=c.scope.captureCurrent.reduce((A,m)=>i(...m,A),void 0),b="stat("+f+",$)";c.scope.firstCurrent?u[c.scope.firstCurrent]=b:u[d]=h(u[d],b)}c.scope=p}function s(l,h){let p=!1;if(r!==null){if(r.has(l))for(let[d,f,b,A]of r.get(l))b==="var"?i(d,f,b):A===!0?c.scope.captureCurrent.push([d,f,b]):(p||(p=o(l),u.push("stat("+p+",")),b&&i(d,f,b,p,A));l.type==="Current"&&c.scope.firstCurrent===null&&c.scope.captureCurrent.disabled!==!0&&(c.scope.firstCurrent=u.length)}if(Qe.has(l.type))Qe.get(l.type)(l,c,h);else throw new Error('Unknown node type "'+l.type+'"');p&&u.push(")")}let y=[],g=new WeakMap,E=[],C=[],u=["((data,context)=>{","const $=data;",{toString(){return E.length>0?"let "+E+`;
`:""}},{toString(){return y.length>0?[`const stat=(s,v)=>(s.add(v),v);
`,"const "+y.map(([l,h])=>l+"=new Set("+(h?JSON.stringify(h):"")+")")+`;
`].join(""):""}},{toString(){let l=r&&Array.isArray(r.literalList)&&r.literalList.map(([h,p])=>h+"="+JSON.stringify(p));return l&&l.length?"const "+l+`;
`:""}},r===null?"return ":`return{
value: `],k={},B=new Set,c={tolerant:e,usedAssertions:new Map,usedMethods:new Map,buildinFn(l){return B.add(l),"f."+l},scope:[],createScope:a,error:(l,h)=>{let p=new SyntaxError(l);if(h&&h.range&&(p.details={loc:{range:h.range}}),!e)throw p},allocateVar(){let l="tmp"+E.length;return E.push(l),l},put:l=>u.push(l),node:s,nodeOrCurrent(l,h){s(l||{type:"Current"},h)},list(l,h,p){l.forEach((d,f)=>{f>0&&u.push(h),s(d,p)})}};if(a(()=>s(t),(l,h)=>(u.push(")"),"("+h+","+l)),!e){let{usedMethods:l,usedAssertions:h}=c;h.size&&(u.unshift(" this.assertAssertions(a)||"),k.assertAssertions=function(p){for(let[d,f]of h.entries())if(!N(p,d))return()=>{throw Object.assign(new Error(`Assertion "${d}" is not defined`),{details:{loc:{range:f}}})}}),l.size&&(u.unshift(" this.assertMethods(m)||"),k.assertMethods=function(p){for(let[d,f]of l.entries())if(!N(p,d))return()=>{throw Object.assign(new Error(`Method "${d}" is not defined. If that's a custom method make sure you added it with "methods" section in options`),{details:{loc:{range:f}}})}})}r!==null&&u.push(`,
stats: [`+C.map(l=>"["+l+"]")+`],
assertions: a
}`);try{let l=new Function("f,m,a","return"+u.join("")+"})");return Object.assign(l.bind(k),{toString(){return l.toString().replace(/^(\S+\s+)anonymous([^)\s]+)\s*\)/,"$1query$2)")}})}catch(l){throw tt("SyntaxError","Jora query compilation error",{compiledSource:u.join(""),details:l})}}var mt=t=>typeof t=="number"||typeof t=="string",_=(t,e)=>e<t.length?t.charCodeAt(e):0,Q=t=>t===43||t===45,q=t=>t>=48&&t<=57,rt=t=>t===9||t===10||t===12||t===13||t===32,nt=t=>t>32&&t<256&&(t<65||t>90)&&(t<97||t>122)&&!q(t)&&!Q(t)||t===8470,di=t=>t&&!rt(t)&&!nt(t)&&!q(t),bi=(t,e,r)=>Q(t)?q(e)?2:e===46&&q(r)?3:0:q(t)?1:0,Y=(t,e,r)=>{for(;r(_(t,++e)););return e},ki=(t,e,r)=>{let n=_(t,e);if(Q(n)&&(n=_(t,e+=1)),q(n)&&(e=Y(t,e,q),n=_(t,e)),n===46&&q(_(t,e+1))){if(r)return e;let o=Y(t,e+1,q);if(n=_(t,o),n===46)return e;e=o}if(n===69||n===101){let o=1;n=_(t,e+1),Q(n)&&(o=2,n=_(t,e+2)),q(n)&&(e=Y(t,e+o,q))}return e},dt=(t,e,r,n)=>{if(e>=t.length)return 0;let o=_(t,e);return rt(o)?1|Y(t,e,rt)-e<<4:nt(o)||n&&Q(o)?2|Y(t,e,nt)-e<<4:bi(o,_(t,e+1),_(t,e+2))?4|ki(t,e,r)-e<<4:8|Y(t,e,di)-e<<4},Ci=(t,e,r)=>{let n=0,o=0,i=!1,a=!1,s=0,y=0,g=!0;for(;;){let E=dt(t,n,i,a),C=dt(e,o,i,a),u=E&15,k=E>>4,B=C&15,c=C>>4;if(u!==B){if(g&&u&3&&B&12){s=1,y=u,n+=k;continue}if(g&&B&3&&u&12){s=-1,y=B,o+=c;continue}return u-B}if(u===0)return s;g=!1,i=!1,a=!1;let l=k<c?k:c,h=k-c,p="",d="";for(let f=0;f<l;f++)if(p=t[n+f],d=e[o+f],p!==d){h=p<d?-1:1;break}if(u&3)i=t[n+k-1]===".",h!==0&&u>y&&(y=u,s=h);else if(u&4){if(a=!0,h!==0){let f=t.substr(n,k)-e.substr(o,c);if(f!==0)return r?-f:f;if(u>y){let b=_(t,n),A=_(e,o),m=b===45?-1:1;y=u,s=b!==A&&(b===45||A===43)?-1:b!==A&&(b===43||A===45)?1:(k-c||h)<0?-m:m,r&&(s=-s)}}}else if(h!==0){if(p!==d){let f=t.substr(n,k),b=e.substr(o,c),A=f.toLowerCase(),m=b.toLowerCase();return A!==m?A<m?-1:1:f<b?-1:1}return h}n+=k,o+=c}},bt=t=>(e,r)=>mt(e)&&mt(r)?Math.sign(Ci(String(e),String(r),t)):0,kt=bt(!1),Ct=bt(!0);var Ei=1,Bi=2,H=3,X=4,wi=5,Di=6,Si=7,Ni=8;function x(t){switch(typeof t){case"boolean":return Ei;case"number":return t!==t?Bi:H;case"string":return X;case"object":return t===null?wi:Di;case"undefined":return Ni;default:return Si}}function V(t,e){let r=x(t),n=x(e);return r!==n?r<n?-1:1:t<e?-1:t>e?1:0}function Et(t,e){let r=x(t),n=x(e);return r!==n?r<n?-1:1:r===H?e-t:t<e?-1:t>e?1:0}function G(t,e){let r=x(t),n=x(e);return(r===H||r===X)&&(n===H||n===X)?kt(t,e):r!==n?r<n?-1:1:t<e?-1:t>e?1:0}function Bt(t,e){let r=x(t),n=x(e);return(r===H||r===X)&&(n===H||n===X)?Ct(t,e,!0):r!==n?r<n?-1:1:t<e?-1:t>e?1:0}function it(t,e){return t.length===1?(r,n)=>e(t(r),t(n)):t}var O=Object.freeze({ensureArray:Oi,bool:M,and:(t,e)=>M(t)?e:t,or:(t,e)=>M(t)?t:e,add:_i,sub:Ti,mul:vi,div:Mi,mod:qi,eq:Fi,ne:Ii,lt:Pi,lte:Ri,gt:xi,gte:zi,in:le,notIn:(t,e)=>!le(t,e),has:(t,e)=>le(e,t),hasNo:(t,e)=>!le(e,t),cmp:V,cmpAnalytical:Et,cmpNatural:G,cmpNaturalAnalytical:Bt,match:ji,pick:Li,indexOf:Gi,lastIndexOf:Ui,map:st,mapRecursive:Hi,some:ot,filter:Vi,slice:Wi});function Oi(t){return Array.isArray(t)?t:[t]}function _i(t,e){return Array.isArray(t)||Array.isArray(e)?[...new Set([].concat(t,e))]:t+e}function Ti(t,e){if(Array.isArray(t)){let r=new Set(t);return Array.isArray(e)?e.forEach(n=>r.delete(n)):r.delete(e),[...r]}return t-e}function vi(t,e){return t*e}function Mi(t,e){return t/e}function qi(t,e){return t%e}function Fi(t,e){return Object.is(t,e)}function Ii(t,e){return!Object.is(t,e)}function Pi(t,e){return t<e}function Ri(t,e){return t<=e}function xi(t,e){return t>e}function zi(t,e){return t>=e}function le(t,e){return v(e)?N(e,t):e?wt(e,t)!==-1:!1}function ji(t,e){return typeof e=="function"?ot(t,e):R(e)?ot(t,e.test.bind(e)):e==null}function Li(t,e=()=>!0){if(!!t){if(typeof e=="function"){if(Array.isArray(t)||typeof t=="string"){for(let r=0;r<t.length;r++)if(e(t[r],r))return t[r]}for(let r in t)if(N(t,r)&&e(t[r],r))return t[r];return}return Array.isArray(t)||typeof t=="string"?isFinite(e)?t[e<0?t.length+Number(e):Number(e)||0]:void 0:N(t,e)?t[e]:void 0}}function Gi(t,e,r){return t?wt(t,e,r):-1}function wt(t,e,r=0){if(Number.isNaN(e)&&I(t)){for(let n=parseInt(r,10)||0;n<t.length;n++)if(Number.isNaN(t[n]))return n}return typeof t.indexOf=="function"?t.indexOf(e,r):-1}function Ui(t,e,r){return t?Yi(t,e,r):-1}function Yi(t,e,r){if(Number.isNaN(e)&&I(t)){for(let n=parseInt(r,10)||t.length-1;n>=0;n--)if(Number.isNaN(t[n]))return n}return typeof t.lastIndexOf=="function"?t.lastIndexOf(e,parseInt(r,10)||t.length-1):-1}function st(t,e){let r=typeof e=="function"?e:n=>ft(n,e);return Array.isArray(t)?[...t.reduce((n,o)=>U(n,r(o)),new Set)]:t!==void 0?r(t):t}function Hi(t,e){let r=new Set;return U(r,st(t,e)),r.forEach(n=>U(r,st(n,e))),[...r]}function ot(t,e){return Array.isArray(t)?t.some(r=>M(e(r))):M(e(t))}function Vi(t,e){return Array.isArray(t)?t.filter(r=>M(e(r))):M(e(t))?t:void 0}function Wi(t,e=0,r=t&&t.length,n=1){if(!I(t))return[];if(e=parseInt(e,10)||0,r=parseInt(r,10)||t.length,n=parseInt(n,10)||1,n!==1){let o=[];e=e<0?Math.max(0,t.length+e):Math.min(t.length,e),r=r<0?Math.max(0,t.length+r):Math.min(t.length,r);for(let i=n>0?e:r-1;i>=e&&i<r;i+=n)o.push(t[i]);return o}return typeof t=="string"?t.slice(e,r):Array.prototype.slice.call(t,e,r)}var Ji=(t,e)=>t-e,Ki=(t,e)=>e-t,ue=class{constructor(e,r,n){this.maxSize=e||1/0,this.compare=r||Ki,this.accept=n||null,this.values=[]}add(e){this.accept!==null&&!this.accept(e)||(this.values.length<this.maxSize?(this.values.push(e),this.heapifyUp(this.values.length-1)):this.compare(this.values[0],e)>0&&(this.values[0]=e,this.heapifyDown()))}addArray(e){for(let r=0;r<e.length;r++)this.add(e[r])}extract(){let e=this.values[0],r=this.values.pop();return this.values.length>0&&(this.values[0]=r,this.heapifyDown()),e}heapifyUp(e){let r=this.values,n=r[e];for(;e>0;){let o=e-1>>1,i=r[o];if(this.compare(i,n)>0)break;r[o]=n,r[e]=i,e=o}}heapifyDown(){let e=this.values,r=e.length,n=r>>1,o=0,i=e[o],a=o,s=i;for(;o<n;){let y=2*o+1,g=e[y],E=y+1;if(this.compare(g,i)>0&&(a=y,s=g),E<r){let C=e[E];this.compare(C,s)>0&&(a=E,s=C)}if(a===o)break;e[o]=s,e[a]=i,o=a,s=i}}[Symbol.iterator](){return this.values.slice().sort(this.compare)[Symbol.iterator]()}},z=class extends ue{},pe=class extends ue{constructor(e,r,n){super(e,r?(o,i)=>-r(o,i):Ji,n)}};var Qi=t=>t;function Xi(t){return t!==null&&typeof t=="object"?NaN:Number(t)}function W(t,e,r){if(I(t)){typeof e!="function"&&(e=Qi);for(let n of t){let o=e(n);o!==void 0&&r(Xi(o))}}}function Dt(t,e,r,n,o){if(t.length===0||!isFinite(e)||e<0||e>100)return;let i=0,a=e*(t.length-1)/100,s=Math.floor(a),y=Math.ceil(a),g=!1,E=e<50?new pe(y+1,o):new z(t.length-s,o);if(W(t,r,C=>{Number.isNaN(C)&&(g=!0),E.add(C),i++}),g)return NaN;if(t.length!==i){if(i===0)return;a=e*(i-1)/100,s=Math.floor(a),y=Math.ceil(a);let C=e<50?y+1:i-s;for(let u=E.values.length;u>C;u--)E.extract()}if(s!==y){let C=E.extract(),u=E.values[0];return C<=u?C+(u-C)*(a-s):u+(C-u)*(a-s)}return E.values[0]}var Zi=t=>t;function St(t,e){let r,n=0,o=0;return W(t,e,i=>{if(o++,r===void 0)r=i;else{let a=r,s=Math.abs(a),y=Math.abs(i);r+=i,s!==1/0&&y!==1/0&&(s>=y?n+=a-r+i:n+=i-r+a)}}),r!==void 0&&(r+=n),{sum:r,count:o}}function Nt(t,e){let r=[];return W(t,e,r.push.bind(r)),r}function Ot(t,e){let r=0;if(I(t)){typeof e!="function"&&(e=Zi);for(let n of t)e(n)!==void 0&&r++}return r}function _t(t,e){return St(t,e).sum}function Tt(t,e){let{sum:r,count:n}=St(t,e);if(n>0)return r/n}function at(t,e){let r=0,n=0,o=0;if(W(t,e,i=>{r+=1;let a=i-n;n+=a/r,o+=a*(i-n)}),r>0)return o/r}function vt(t,e){let r=at(t,e);if(r!==void 0)return Math.sqrt(r)}function Mt(t,e=G){let r;if(t&&isFinite(t.length)&&typeof e=="function"){e=it(e,G);for(let n=0;n<t.length;n++){let o=t[n];(r===void 0||e(o,r)<0)&&e(o,void 0)!==0&&(r=o)}}return r}function qt(t,e=G){let r;if(t&&isFinite(t.length)&&typeof e=="function"){e=it(e,G);for(let n=0;n<t.length;n++){let o=t[n];(r===void 0||e(o,r)>=0)&&e(o,void 0)!==0&&(r=o)}}return r}function ce(t,e,r){if(I(t))return Dt(t,e,r)}function Ft(t,e){return ce(t,50,e)}function $i(){}function es(t){return t}function It(t){return t===null?null:{matched:t.slice(),start:t.index,end:t.index+t[0].length,input:t.input,groups:t.groups||null}}function ts(t){let e=t.pop(),r=typeof e=="string"?null:e,n=r===null?e:t.pop(),o=t.pop();return{matched:t,start:o,end:o+t[0].length,input:n,groups:r}}var rs=String.prototype.replaceAll||function(t,e){return R(t)?this.replace(t,e):this.split(t).join(String(e))},ns=Pt(20)?1/0:Pt(10)?10:0;function Pt(t){return Array.from({length:t},(e,r)=>({idx:r})).sort((e,r)=>e.idx%2-r.idx%2).every((e,r)=>r<t/2?e.idx>>1===r:Math.ceil(t/2)+(e.idx>>1)===r)}function is(t,e){return t.length<=ns?t.slice().sort(e):t.map((r,n)=>({value:r,idx:n})).sort((r,n)=>(r.value===void 0?n.value!==void 0:n.value===void 0?-1:e(r.value,n.value))||r.idx-n.idx).map(r=>r.value)}var Z=Object.freeze({bool:O.bool,filter:O.filter,map:O.map,pick:O.pick,indexOf:O.indexOf,lastIndexOf:O.lastIndexOf,keys(t){return Object.keys(t||{})},values(t){let e=new Set;for(let r in t)N(t,r)&&U(e,t[r]);return[...e]},entries(t){let e=[];for(let r in t)N(t,r)&&e.push({key:r,value:t[r]});return e},fromEntries(t){let e=Object.create(null);if(Array.isArray(t))for(let r of t)r&&(e[r.key]=r.value);return e},size(t){return v(t)?Object.keys(t).length:t&&t.length||0},sort(t,e=V){if(!Array.isArray(t))return t;if(typeof e=="function"&&e.length!==2){let r=e;e=(n,o)=>{if(n=r(n),o=r(o),Array.isArray(n)&&Array.isArray(o)){if(n.length!==o.length)return n.length<o.length?-1:1;for(let i=0;i<n.length;i++){let a=V(n[i],o[i]);if(a!==0)return a}return 0}return V(n,o)}}return is(t,e)},reverse(t){return Array.isArray(t)?t.slice().reverse():t},slice(t,e,r){return O.slice(t,e,r)},group(t,e,r){let n=new Map,o=[];typeof e!="function"&&(e=$i),typeof r!="function"&&(r=es),Array.isArray(t)||(t=[t]);for(let i of t){let a=e(i);if(Array.isArray(a))for(let s of a)ge(n,s,r(i));else ge(n,a,r(i))}for(let[i,a]of n)o.push({key:i,value:[...a]});return o},join(t,e){return Array.isArray(t)?t.join(e):String(t)},match(t,e,r){let n=String(t),o=R(e)?e.flags:"";if(r||o.includes("g")){let i=[],a=new RegExp(e,(o||"").replace(/g|$/,"g")),s;for(;s=a.exec(n);)i.push(It(s));return i}return It(n.match(e))},reduce(t,e,r=void 0){return Array.isArray(t)?r!==void 0?t.reduce((n,o)=>e(o,n),r):t.reduce((n,o)=>e(o,n)):e(t,r)},split(t,e){if(Array.isArray(t)){let r=typeof e=="function"?e:Object.is.bind(null,e),n=[],o=0,i=0;for(;i<t.length;i++)r(t[i])&&(n.push(t.slice(o,i)),o=i+1);return n.push(t.slice(o,i)),n}return String(t).split(e)},replace(t,e,r){if(Array.isArray(t)){let n=typeof e=="function"?e:Object.is.bind(null,e);return t.map(typeof r=="function"?o=>n(o)?r(o):o:o=>n(o)?r:o)}return R(e)&&!e.flags.includes("g")&&(e=new RegExp(e,e.flags+"g")),rs.call(String(t),e,typeof r=="function"?(...n)=>r(ts(n)):r)},toLowerCase(t,e){return String(t).toLocaleLowerCase(e)},toUpperCase(t,e){return String(t).toLocaleUpperCase(e)},trim(t){return String(t).trim()},...["abs","acos","acosh","asin","asinh","atan","atan2","atanh","cbrt","ceil","clz32","cos","cosh","exp","expm1","floor","fround","hypot","imul","log10","log2","pow","round","sign","sin","sinh","sqrt","tan","tanh","trunc"].reduce((t,e)=>(t[e]=Math[e],t),{}),ln:Math.log,ln1p:Math.log1p,numbers:Nt,count:Ot,sum:_t,avg:Tt,variance:at,stdev:vt,min:Mt,max:qt,percentile:ce,p:ce,median:Ft});var $=Object.freeze({function:t=>typeof t=="function",symbol:t=>typeof t=="symbol",primitive:t=>t===null||typeof t!="object"&&typeof t!="function",string:t=>typeof t=="string",number:t=>typeof t=="number",int:Number.isInteger,finite:t=>Number.isFinite(t),nan:t=>Number.isNaN(t),infinity:t=>t===1/0||t===-1/0,boolean:t=>t===!0||t===!1,null:t=>t===null,undefined:t=>t===void 0,nullish:t=>t==null,object:v,array:Array.isArray,regexp:R,truthy:M,falsy:t=>!M(t)});var ss={path:"property",key:"value",value:"value","in-value":"value","value-subset":"value",var:"variable",assertion:"assertion"};function fe(t,e){Object.keys(t).forEach(e.add,e)}function os(t,e,r,n=new Set){let o=i=>{switch(typeof i){case"string":case"number":n.add(i);break}};switch(t){case"path":{let i=new Set;for(let a of e)if(Array.isArray(a))for(let s of a)v(s)&&fe(s,i);else v(a)&&fe(a,i);i.forEach(n.add,n);break}case"key":{let i=new Set;for(let a of e)a!==null&&typeof a=="object"&&!Array.isArray(a)&&fe(a,i);i.forEach(n.add,n);break}case"value":for(let i of e)o(i);break;case"in-value":{let i=new Set;for(let a of e)Array.isArray(a)?a.forEach(o):v(a)&&fe(a,i);i.forEach(n.add,n);break}case"var":for(let i of e)n.add("$"+i);break;case"value-subset":{let i=new Set(r);for(let a of e)i.has(a)||o(a);break}}return n}function Rt(t,e,r,n=!1){let o=[];for(let[i,a,s,y,g=null]of r)if(e>=i&&e<=a&&(n||y.size||y.length)){let E=t.substring(i,a);/\S/.test(E)||(i=a=e,E=""),o.push({context:s,from:i,to:a,text:E,values:y,related:g})}return o}function xt(t,e){return typeof t=="function"?t:t===!0?e:!1}function zt(t){if(/^(["']).*\1$/.test(t))try{return t[0]==="'"&&(t=`"${t.slice(1,-1).replace(/\\.|"/g,e=>e==="\\'"?"'":e==='"'?'\\"':e)}"`),JSON.parse(t)}catch{}return t}function as(t){return e=>(typeof e=="string"?e:String(e)).toLowerCase().indexOf(t)!==-1}var lt=(t,{value:e,stats:r,assertions:n})=>({get value(){return e},stat(o,i){return Rt(t,o,r,i)},suggestion(o,i){let{limit:a=1/0,sort:s,filter:y}=i||{};s=xt(s,O.cmp),y=xt(y,as);let g=s&&isFinite(a)?z:Set,E=Rt(t,o,r,!0),C=new Map,u=[];for(let k of E){let{context:B,text:c,from:l,to:h,values:p,related:d}=k,f=ss[B];if(!C.has(f)){let A;switch(g){case z:A=new z(a,s,y&&y(zt(c)));break;case Set:A=new Set;break}C.set(f,{type:f,from:l,to:h,text:c,suggestions:A})}let{suggestions:b}=C.get(f);switch(B){case"assertion":if(b.size===0||b.values&&b.values.length===0)for(let A of Object.keys(n))b.add(A);break;default:os(B,p,d,b)}}if(g===Set)for(let k of C.values()){let{suggestions:B}=k;if(s&&(B=[...B].sort(s)),y||isFinite(a)){let c=[],l=y?y(zt(k.text)):()=>!0;for(let h of B)if(l(h)&&c.push(h)>=a)break;B=c}k.suggestions=B}for(let k of C.values())k.suggestions=Array.isArray(k.suggestions)?k.suggestions:[...k.suggestions],k.suggestions.length&&u.push(k);return u.length?u:null}});var ls=new Map,us=new Map,ps=new Map,cs=new Map;function jt(t,e,r,n,o){typeof r=="string"?Object.defineProperty(t,e,{configurable:!0,get(){let i=ut(r)(O,n,o),a=s=>i(s,null);return Object.defineProperty(t,e,{value:a}),a}}):t[e]=r}function Lt(t,e){if(!t&&!e)return{queryMethods:Z,queryAssertions:$};let r={...Z},n={...$};for(let[o,i]of Object.entries(t||{})){if(N(Z,o))throw new Error(`Builtin method "${o}" can't be overridden`);jt(r,o,i,r,n)}for(let[o,i]of Object.entries(e||{})){if(N($,o))throw new Error(`Builtin assertion "${o}" can't be overridden`);jt(n,o,i,r,n)}return{queryMethods:r,queryAssertions:n}}function fs(t,e){console.log(`[${t}]`),typeof e=="string"?console.log(e):e!==void 0&&console.dir(e,{depth:null}),console.log()}function ut(t,e,r,n){n=typeof n=="function"?n:Boolean(n)?fs:!1,n&&(n("========================="),n("Compile query from source",t));let o=te.parse(t,r);n&&(n("AST",o.ast),n("Restored source",oe(o.ast)));let i=e?se(t,o):null;if(n&&i){let s=C=>JSON.stringify(C).slice(1,-1),y=[].concat(...[...i.entries()].map(([C,u])=>u.map(k=>[C,...k]))),g=[],E=null;n("Stat/suggestion ranges",y.sort((C,u)=>C[1]-u[1]).map(([C,...u])=>{let[k,B,c,l]=u,h;if(k===g[0]&&B===g[1])h=" ".repeat(E.length);else{let p=s(t.slice(0,k)).length,d=s(t.substring(k,B)).length;g=u,E=" ".repeat(p)+(d?"~".repeat(d):"\\")+" "+k+":"+B,h=s(t)+`
`+E}return h+" ["+c+"] on "+C.type+(l===!0?" (current)":l&&l.type?" & "+l.type:"")}).join(`
`))}let a=ae(o.ast,r,i);return n&&n("Compiled code",a.toString()),a}function hs(t,e){e=e||{};let r=Boolean(e.stat),n=Boolean(e.tolerant),o=r?n?cs:us:n?ps:ls,{methods:i,assertions:a}=e||{},{queryMethods:s,queryAssertions:y}=Lt(i,a),g;return t=String(t),o.has(t)&&!e.debug?g=o.get(t):(g=ut(t,r,n,e.debug),o.set(t,g)),g=g(O,s,y),r?Object.assign((E,C)=>lt(t,g(E,C)),{query:g}):g}function gs(t){let e=new Map,r=new Map,n=new Map,o=new Map,{methods:i,assertions:a}=t||{},{queryMethods:s,queryAssertions:y}=Lt(i,a);return function(E,C){C=C||{};let u=Boolean(C.stat),k=Boolean(C.tolerant),B=u?k?o:r:k?n:e,c;if(E=String(E),B.has(E)&&!C.debug)c=B.get(E);else{let l=ut(E,u,k,C.debug)(O,s,y);c=u?Object.assign((h,p)=>lt(E,l(h,p)),{query:l}):l,B.set(E,c)}return c}}var ys=Object.assign(hs,{version:ct,buildin:O,methods:Z,assertions:$,setup:gs,syntax:{tokenize:te.tokenize,parse:te.parse,suggest:se,walk:K,stringify:oe,compile:ae}});return Vt(As);})();
jora=jora.default;
//# sourceMappingURL=jora.js.map
