{"version":3,"file":"manager.js","names":["setAdapter","instance","manager","configFromAdapter","config","store","dispatch","type","payload","incompatibleFeatures","supports","pathPrefix","getState","program","prefixPaths","push","trailingSlash","includes","length","map","option","join","reporter","warn","name","line","pluginsToDisable","reason","initAdapterManager","adapter","adapterFromGatsbyConfig","verbose","adapterInit","getAdapterInit","telemetry","trackFeatureIsUsed","noOpAdapterManager","info","directoriesToCache","restoreCache","cache","result","restore","directories","cachedState","readState","Object","keys","storeCache","adapt","mdbInPublicPath","LmdbOnCdnPath","shouldBundleDatastore","mdbPath","getDefaultDbPath","copy","pathExists","unlink","_routesManifest","undefined","_functionsManifest","_headerRoutes","adaptContext","routesManifest","routes","headers","getRoutesManifest","functionsManifest","getFunctionsManifest","headerRoutes","excludeDatastoreFromEngineFunction","deployURL","Error","webpackAssets","setWebpackAssets","assets","headersAreEqual","a","b","key","value","getDefaultHeaderRoutes","path","BASE_HEADERS","PERMANENT_CACHE_CONTROL_HEADER","customHeaderFilter","route","h","baseHeader","startsWith","cachingHeader","PERMAMENT_CACHING_HEADERS","state","createHeaders","createHeadersMatcher","fileAssets","Set","globSync","cwd","posix","process","nodir","dot","filePath","slash","addRoute","applyTrailingSlashOption","customHeaders","filter","routeWithScore","score","rankRoute","addStaticRoute","pathToFillInPublicDir","has","delete","page","pages","values","htmlRoutePath","getRoutePathFromPage","pageDataRoutePath","generatePageDataPath","pageMode","getPageMode","htmlFilePath","generateHtmlPath","pageDataFilePath","MUST_REVALIDATE_HEADERS","commonFields","functionId","staticQueryComponent","staticQueryComponents","staticQueryResultPath","getStaticQueryPath","hash","appDataFilePath","panic","id","context","asset","chunkMapFilePath","webpackStatsFilePath","slice","slices","sliceDataPath","addSliceHtmlRoute","hasChildren","sliceHtml1Path","sliceHtml2Path","html","slicesProps","bySliceId","entries","redirect","redirects","fromPath","toPath","statusCode","isPermanent","ignoreCase","redirectInBrowser","platformSpecificFields","status","HTTP_STATUS_CODE","MOVED_PERMANENTLY_301","FOUND_302","functionInfo","functions","getRoutePathFromFunction","fileAsset","sortedRoutes","sort","order","localeCompare","rest","pathToEntryPoint","relativeCompiledFilePath","relativePathWithoutFileExtension","parse","originalRelativeFilePath","dir","requiredFiles","shouldGenerateEngines","getFilesFrom","file"],"sources":["../../../src/utils/adapter/manager.ts"],"sourcesContent":["import reporter from \"gatsby-cli/lib/reporter\"\nimport { applyTrailingSlashOption, TrailingSlash } from \"gatsby-page-utils\"\nimport { generateHtmlPath } from \"gatsby-core-utils/page-html\"\nimport { slash } from \"gatsby-core-utils/path\"\nimport { generatePageDataPath } from \"gatsby-core-utils/page-data\"\nimport { posix } from \"path\"\nimport { sync as globSync } from \"glob\"\nimport telemetry from \"gatsby-telemetry\"\nimport { copy, pathExists, unlink } from \"fs-extra\"\nimport type {\n  FunctionsManifest,\n  IAdaptContext,\n  RoutesManifest,\n  Route,\n  IAdapterManager,\n  IFunctionRoute,\n  IAdapter,\n  IAdapterFinalConfig,\n  IAdapterConfig,\n  HeaderRoutes,\n} from \"./types\"\nimport { store, readState } from \"../../redux\"\nimport { getPageMode } from \"../page-mode\"\nimport { getStaticQueryPath } from \"../static-query-utils\"\nimport { getAdapterInit } from \"./init\"\nimport {\n  LmdbOnCdnPath,\n  shouldBundleDatastore,\n  shouldGenerateEngines,\n} from \"../engines-helpers\"\nimport {\n  BASE_HEADERS,\n  MUST_REVALIDATE_HEADERS,\n  PERMAMENT_CACHING_HEADERS,\n  PERMANENT_CACHE_CONTROL_HEADER,\n} from \"./constants\"\nimport { createHeadersMatcher } from \"./create-headers\"\nimport { HTTP_STATUS_CODE } from \"../../redux/types\"\nimport type { IHeader } from \"../../redux/types\"\nimport { rankRoute } from \"../rank-route\"\nimport {\n  getRoutePathFromFunction,\n  getRoutePathFromPage,\n} from \"./get-route-path\"\nimport { noOpAdapterManager } from \"./no-op-manager\"\nimport { getDefaultDbPath } from \"../../datastore/lmdb/lmdb-datastore\"\n\nasync function setAdapter({\n  instance,\n  manager,\n}: {\n  instance?: IAdapter\n  manager: IAdapterManager\n}): Promise<void> {\n  const configFromAdapter = await manager.config()\n\n  store.dispatch({\n    type: `SET_ADAPTER`,\n    payload: {\n      manager,\n      instance,\n      config: configFromAdapter,\n    },\n  })\n\n  if (instance) {\n    // if adapter reports that it doesn't support certain features, we need to fail the build\n    // to avoid broken deploys\n\n    const incompatibleFeatures: Array<string> = []\n\n    // pathPrefix support\n    if (\n      configFromAdapter?.supports?.pathPrefix === false &&\n      store.getState().program.prefixPaths &&\n      store.getState().config.pathPrefix\n    ) {\n      incompatibleFeatures.push(`pathPrefix is not supported.`)\n    }\n\n    // trailingSlash support\n    if (configFromAdapter?.supports?.trailingSlash) {\n      const { trailingSlash } = store.getState().config\n\n      if (\n        !configFromAdapter.supports.trailingSlash.includes(\n          trailingSlash ?? `always`\n        )\n      ) {\n        incompatibleFeatures.push(\n          `trailingSlash option \"${trailingSlash}\". Supported option${\n            configFromAdapter.supports.trailingSlash.length > 1 ? `s` : ``\n          }: ${configFromAdapter.supports.trailingSlash\n            .map(option => `\"${option}\"`)\n            .join(`, `)}`\n        )\n      }\n    }\n\n    if (incompatibleFeatures.length > 0) {\n      reporter.warn(\n        `Adapter \"${\n          instance.name\n        }\" is not compatible with following settings:\\n${incompatibleFeatures\n          .map(line => ` - ${line}`)\n          .join(`\\n`)}`\n      )\n    }\n\n    if (configFromAdapter.pluginsToDisable.length > 0) {\n      store.dispatch({\n        type: `DISABLE_PLUGINS_BY_NAME`,\n        payload: {\n          pluginsToDisable: configFromAdapter.pluginsToDisable,\n          reason: `Not compatible with the \"${instance.name}\" adapter. Please remove it from your gatsby-config.`,\n        },\n      })\n    }\n  }\n}\n\nexport async function initAdapterManager(): Promise<IAdapterManager> {\n  let adapter: IAdapter\n\n  const config = store.getState().config\n  const { adapter: adapterFromGatsbyConfig, trailingSlash, pathPrefix } = config\n\n  // If the user specified an adapter inside their gatsby-config, use that instead of trying to figure out an adapter for the current environment\n  if (adapterFromGatsbyConfig) {\n    adapter = adapterFromGatsbyConfig\n\n    reporter.verbose(`Using adapter ${adapter.name} from gatsby-config`)\n  } else {\n    const adapterInit = await getAdapterInit()\n\n    // If we don't have adapter, use no-op adapter manager\n    if (!adapterInit) {\n      telemetry.trackFeatureIsUsed(`adapter:no-op`)\n\n      const manager = noOpAdapterManager()\n\n      await setAdapter({ manager })\n\n      return manager\n    }\n\n    adapter = adapterInit()\n  }\n\n  reporter.info(`Using ${adapter.name} adapter`)\n  telemetry.trackFeatureIsUsed(`adapter:${adapter.name}`)\n\n  const directoriesToCache = [`.cache`, `public`]\n  const manager: IAdapterManager = {\n    restoreCache: async (): Promise<void> => {\n      if (!adapter.cache) {\n        return\n      }\n\n      const result = await adapter.cache.restore({\n        directories: directoriesToCache,\n        reporter,\n      })\n      if (result === false) {\n        // if adapter reports `false`, we can skip trying to re-hydrate state\n        return\n      }\n\n      const cachedState = readState()\n\n      // readState() returns empty object if there is no cached state or it's corrupted etc\n      // so we want to avoid dispatching RESTORE_CACHE action in that case\n      if (Object.keys(cachedState).length > 0) {\n        store.dispatch({\n          type: `RESTORE_CACHE`,\n          payload: cachedState,\n        })\n      }\n    },\n    storeCache: async (): Promise<void> => {\n      if (!adapter.cache) {\n        return\n      }\n\n      await adapter.cache.store({ directories: directoriesToCache, reporter })\n    },\n    adapt: async (): Promise<void> => {\n      if (!adapter.adapt) {\n        return\n      }\n\n      // handle lmdb file\n      const mdbInPublicPath = `public/${LmdbOnCdnPath}`\n      if (!shouldBundleDatastore()) {\n        const mdbPath = getDefaultDbPath() + `/data.mdb`\n        copy(mdbPath, mdbInPublicPath)\n      } else {\n        // ensure public dir doesn't have lmdb file\n        if (await pathExists(mdbInPublicPath)) {\n          await unlink(mdbInPublicPath)\n        }\n      }\n\n      let _routesManifest: RoutesManifest | undefined = undefined\n      let _functionsManifest: FunctionsManifest | undefined = undefined\n      let _headerRoutes: HeaderRoutes | undefined = undefined\n      const adaptContext: IAdaptContext = {\n        get routesManifest(): RoutesManifest {\n          if (!_routesManifest) {\n            const { routes, headers } = getRoutesManifest()\n            _routesManifest = routes\n            _headerRoutes = headers\n          }\n\n          return _routesManifest\n        },\n        get functionsManifest(): FunctionsManifest {\n          if (!_functionsManifest) {\n            _functionsManifest = getFunctionsManifest()\n          }\n\n          return _functionsManifest\n        },\n        get headerRoutes(): HeaderRoutes {\n          if (!_headerRoutes) {\n            const { routes, headers } = getRoutesManifest()\n            _routesManifest = routes\n            _headerRoutes = headers\n          }\n\n          return _headerRoutes\n        },\n        reporter,\n        // Our internal Gatsby config allows this to be undefined but for the adapter we should always pass through the default values and correctly show this in the TypeScript types\n        trailingSlash: trailingSlash as TrailingSlash,\n        pathPrefix: pathPrefix as string,\n      }\n\n      await adapter.adapt(adaptContext)\n    },\n    config: async (): Promise<IAdapterFinalConfig> => {\n      let configFromAdapter: undefined | IAdapterConfig = undefined\n      if (adapter.config) {\n        configFromAdapter = await adapter.config({ reporter })\n\n        if (\n          configFromAdapter?.excludeDatastoreFromEngineFunction &&\n          !configFromAdapter?.deployURL\n        ) {\n          throw new Error(\n            `Can't exclude datastore from engine function without adapter providing deployURL`\n          )\n        }\n      }\n\n      return {\n        excludeDatastoreFromEngineFunction:\n          configFromAdapter?.excludeDatastoreFromEngineFunction ?? false,\n        deployURL: configFromAdapter?.deployURL,\n        supports: configFromAdapter?.supports,\n        pluginsToDisable: configFromAdapter?.pluginsToDisable ?? [],\n      }\n    },\n  }\n\n  await setAdapter({ manager, instance: adapter })\n\n  return manager\n}\n\nlet webpackAssets: Set<string> | undefined\nexport function setWebpackAssets(assets: Set<string>): void {\n  webpackAssets = assets\n}\n\ntype RouteWithScore = { score: number } & Route\n\nconst headersAreEqual = (a, b): boolean =>\n  a.key === b.key && a.value === b.value\n\nconst getDefaultHeaderRoutes = (pathPrefix: string): HeaderRoutes => [\n  {\n    path: `${pathPrefix}/*`,\n    headers: BASE_HEADERS,\n  },\n  {\n    path: `${pathPrefix}/static/*`,\n    headers: PERMANENT_CACHE_CONTROL_HEADER,\n  },\n]\n\nconst customHeaderFilter =\n  (route: Route, pathPrefix: string) =>\n  (h: IHeader[\"headers\"][0]): boolean => {\n    for (const baseHeader of BASE_HEADERS) {\n      if (headersAreEqual(baseHeader, h)) {\n        return false\n      }\n    }\n    if (route.path.startsWith(`${pathPrefix}/static/`)) {\n      for (const cachingHeader of PERMAMENT_CACHING_HEADERS) {\n        if (headersAreEqual(cachingHeader, h)) {\n          return false\n        }\n      }\n    }\n    return true\n  }\n\nfunction getRoutesManifest(): {\n  routes: RoutesManifest\n  headers: HeaderRoutes\n} {\n  const routes: Array<RouteWithScore> = []\n  const state = store.getState()\n  const createHeaders = createHeadersMatcher(state.config.headers)\n  const pathPrefix = state.program.prefixPaths\n    ? state.config.pathPrefix ?? ``\n    : ``\n\n  const headerRoutes: HeaderRoutes = [...getDefaultHeaderRoutes(pathPrefix)]\n\n  const fileAssets = new Set(\n    globSync(`**/**`, {\n      cwd: posix.join(process.cwd(), `public`),\n      nodir: true,\n      dot: true,\n    }).map(filePath => slash(filePath))\n  )\n\n  // TODO: This could be a \"addSortedRoute\" function that would add route to the list in sorted order. TBD if necessary performance-wise\n  function addRoute(route: Route): void {\n    if (\n      !(route.path.startsWith(`https://`) || route.path.startsWith(`http://`))\n    ) {\n      if (!route.path.startsWith(`/`)) {\n        route.path = `/${route.path}`\n      }\n\n      if (pathPrefix && !route.path.startsWith(pathPrefix)) {\n        route.path = posix.join(pathPrefix, route.path)\n      }\n    }\n\n    // Apply trailing slash behavior unless it's a redirect. Redirects should always be exact matches\n    if (route.type !== `redirect`) {\n      route.path = applyTrailingSlashOption(\n        route.path,\n        state.config.trailingSlash\n      )\n    }\n\n    if (route.type !== `function`) {\n      route.headers = createHeaders(route.path, route.headers)\n      const customHeaders = route.headers.filter(\n        customHeaderFilter(route, pathPrefix)\n      )\n      if (customHeaders.length > 0) {\n        headerRoutes.push({ path: route.path, headers: customHeaders })\n      }\n    }\n\n    const routeWithScore: RouteWithScore = {\n      ...route,\n      score: rankRoute(route.path),\n    }\n\n    routes.push(routeWithScore)\n  }\n\n  function addStaticRoute({\n    path,\n    pathToFillInPublicDir,\n    headers,\n  }: {\n    path: string\n    pathToFillInPublicDir: string\n    headers: IHeader[\"headers\"]\n  }): void {\n    addRoute({\n      path,\n      type: `static`,\n      filePath: posix.join(`public`, pathToFillInPublicDir),\n      headers,\n    })\n\n    if (fileAssets.has(pathToFillInPublicDir)) {\n      fileAssets.delete(pathToFillInPublicDir)\n    } else {\n      reporter.verbose(\n        `[Adapters] Tried to remove \"${pathToFillInPublicDir}\" from fileAssets but it wasn't there`\n      )\n    }\n  }\n\n  // routes - pages - static (SSG) or function (DSG/SSR)\n  for (const page of state.pages.values()) {\n    const htmlRoutePath = slash(getRoutePathFromPage(page))\n    const pageDataRoutePath = slash(generatePageDataPath(``, htmlRoutePath))\n\n    const pageMode = getPageMode(page)\n\n    if (pageMode === `SSG`) {\n      const htmlFilePath = slash(generateHtmlPath(``, page.path))\n      const pageDataFilePath = slash(generatePageDataPath(``, page.path))\n\n      addStaticRoute({\n        path: htmlRoutePath,\n        pathToFillInPublicDir: htmlFilePath,\n        headers: MUST_REVALIDATE_HEADERS,\n      })\n      addStaticRoute({\n        path: pageDataRoutePath,\n        pathToFillInPublicDir: pageDataFilePath,\n        headers: MUST_REVALIDATE_HEADERS,\n      })\n    } else {\n      const commonFields: Omit<IFunctionRoute, \"path\"> = {\n        type: `function`,\n        functionId: `ssr-engine`,\n      }\n\n      if (pageMode === `DSG`) {\n        commonFields.cache = true\n      }\n\n      addRoute({\n        path: htmlRoutePath,\n        ...commonFields,\n      })\n\n      addRoute({\n        path: pageDataRoutePath,\n        ...commonFields,\n      })\n    }\n  }\n\n  // static query json assets\n  for (const staticQueryComponent of state.staticQueryComponents.values()) {\n    const staticQueryResultPath = getStaticQueryPath(staticQueryComponent.hash)\n    addStaticRoute({\n      path: staticQueryResultPath,\n      pathToFillInPublicDir: staticQueryResultPath,\n      headers: MUST_REVALIDATE_HEADERS,\n    })\n  }\n\n  // app-data.json\n  {\n    const appDataFilePath = posix.join(`page-data`, `app-data.json`)\n    addStaticRoute({\n      path: appDataFilePath,\n      pathToFillInPublicDir: appDataFilePath,\n      headers: MUST_REVALIDATE_HEADERS,\n    })\n  }\n\n  // webpack assets\n  if (!webpackAssets) {\n    reporter.panic({\n      id: `12200`,\n      context: {},\n    })\n  }\n\n  for (const asset of webpackAssets) {\n    addStaticRoute({\n      path: asset,\n      pathToFillInPublicDir: asset,\n      headers: PERMAMENT_CACHING_HEADERS,\n    })\n  }\n\n  // chunk-map.json\n  {\n    const chunkMapFilePath = posix.join(`chunk-map.json`)\n    addStaticRoute({\n      path: chunkMapFilePath,\n      pathToFillInPublicDir: chunkMapFilePath,\n      headers: MUST_REVALIDATE_HEADERS,\n    })\n  }\n\n  // webpack.stats.json\n  {\n    const webpackStatsFilePath = posix.join(`webpack.stats.json`)\n    addStaticRoute({\n      path: webpackStatsFilePath,\n      pathToFillInPublicDir: webpackStatsFilePath,\n      headers: MUST_REVALIDATE_HEADERS,\n    })\n  }\n\n  for (const slice of state.slices.values()) {\n    const sliceDataPath = posix.join(`slice-data`, `${slice.name}.json`)\n\n    addStaticRoute({\n      path: sliceDataPath,\n      pathToFillInPublicDir: sliceDataPath,\n      headers: MUST_REVALIDATE_HEADERS,\n    })\n  }\n\n  function addSliceHtmlRoute(name: string, hasChildren: boolean): void {\n    const sliceHtml1Path = posix.join(`_gatsby`, `slices`, `${name}-1.html`)\n    addStaticRoute({\n      path: sliceHtml1Path,\n      pathToFillInPublicDir: sliceHtml1Path,\n      headers: MUST_REVALIDATE_HEADERS,\n    })\n    if (hasChildren) {\n      const sliceHtml2Path = posix.join(`_gatsby`, `slices`, `${name}-2.html`)\n      addStaticRoute({\n        path: sliceHtml2Path,\n        pathToFillInPublicDir: sliceHtml2Path,\n        headers: MUST_REVALIDATE_HEADERS,\n      })\n    }\n  }\n\n  addSliceHtmlRoute(`_gatsby-scripts`, false)\n  for (const [\n    name,\n    { hasChildren },\n  ] of state.html.slicesProps.bySliceId.entries()) {\n    addSliceHtmlRoute(name, hasChildren)\n  }\n\n  // redirect routes\n  for (const redirect of state.redirects.values()) {\n    const {\n      fromPath,\n      toPath,\n      statusCode,\n      isPermanent,\n      ignoreCase,\n      redirectInBrowser,\n      ...platformSpecificFields\n    } = redirect\n\n    addRoute({\n      path: fromPath,\n      type: `redirect`,\n      toPath: toPath,\n      status:\n        statusCode ??\n        (isPermanent\n          ? HTTP_STATUS_CODE.MOVED_PERMANENTLY_301\n          : HTTP_STATUS_CODE.FOUND_302),\n      ignoreCase: ignoreCase,\n      headers: BASE_HEADERS,\n      ...platformSpecificFields,\n    })\n  }\n\n  // function routes\n  for (const functionInfo of state.functions.values()) {\n    addRoute({\n      path: `/api/${getRoutePathFromFunction(functionInfo)}`,\n      type: `function`,\n      functionId: functionInfo.functionId,\n    })\n  }\n\n  for (const fileAsset of fileAssets) {\n    // try to classify remaining assets\n    let headers: IHeader[\"headers\"] | undefined = undefined\n\n    if (fileAsset.startsWith(`~partytown`)) {\n      // no hashes, must revalidate\n      headers = MUST_REVALIDATE_HEADERS\n    } else if (\n      fileAsset.startsWith(`_gatsby/image`) ||\n      fileAsset.startsWith(`_gatsby/file`)\n    ) {\n      headers = PERMAMENT_CACHING_HEADERS\n    }\n\n    if (!headers) {\n      headers = BASE_HEADERS\n    }\n\n    addStaticRoute({\n      path: fileAsset,\n      pathToFillInPublicDir: fileAsset,\n      headers,\n    })\n  }\n\n  const sortedRoutes = routes\n    .sort((a, b) => {\n      // The higher the score, the higher the specificity of our path\n      const order = b.score - a.score\n      if (order !== 0) {\n        return order\n      }\n\n      // if specificity is the same we do lexigraphic comparison of path to ensure\n      // deterministic order regardless of order pages where created\n      return a.path.localeCompare(b.path)\n    })\n    // The score should be internal only, so we remove it from the final manifest\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    .map(({ score, ...rest }): Route => {\n      return { ...rest }\n    })\n  return {\n    routes: sortedRoutes,\n    headers: headerRoutes,\n  }\n}\n\nfunction getFunctionsManifest(): FunctionsManifest {\n  const functions = [] as FunctionsManifest\n\n  for (const functionInfo of store.getState().functions.values()) {\n    const pathToEntryPoint = posix.join(\n      `.cache`,\n      `functions`,\n      functionInfo.relativeCompiledFilePath\n    )\n    const relativePathWithoutFileExtension = posix.join(\n      posix.parse(functionInfo.originalRelativeFilePath).dir,\n      posix.parse(functionInfo.originalRelativeFilePath).name\n    )\n\n    functions.push({\n      functionId: functionInfo.functionId,\n      name: `/api/${relativePathWithoutFileExtension}`,\n      pathToEntryPoint,\n      requiredFiles: [pathToEntryPoint],\n    })\n  }\n\n  if (shouldGenerateEngines()) {\n    function getFilesFrom(dir: string): Array<string> {\n      return globSync(`**/**`, {\n        cwd: posix.join(process.cwd(), dir),\n        nodir: true,\n        dot: true,\n      }).map(file => posix.join(dir, file))\n    }\n\n    functions.push({\n      functionId: `ssr-engine`,\n      pathToEntryPoint: posix.join(`.cache`, `page-ssr`, `lambda.js`),\n      name: `SSR & DSG`,\n      requiredFiles: [\n        `public/404.html`,\n        `public/500.html`,\n        ...(shouldBundleDatastore()\n          ? getFilesFrom(posix.join(`.cache`, `data`, `datastore`))\n          : []),\n        ...getFilesFrom(posix.join(`.cache`, `page-ssr`)),\n        ...getFilesFrom(posix.join(`.cache`, `query-engine`)),\n      ],\n    })\n  }\n\n  return functions\n}\n\nexport { getRoutesManifest, getFunctionsManifest }\n"],"mappings":"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"}