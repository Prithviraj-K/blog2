"use strict";(self.webpackChunkminimal_blog=self.webpackChunkminimal_blog||[]).push([[513],{4765:function(e,n,t){t.d(n,{F:function(){return p},Z:function(){return d}});var a=t(7294),l=t(8733),r=t(795),c=t(8377),o=t(6799),s=t(8871);var i=e=>{let{post:n}=e;return null};const m=["16px","8px","4px"].map((e=>`rgba(0, 0, 0, 0.1) 0px ${e} ${e} 0px`));var u=e=>{let{data:{post:n},children:t}=e;return(0,l.tZ)(c.Z,null,(0,l.tZ)(r.X6,{as:"h1",variant:"styles.h1"},n.title),(0,l.tZ)("p",{sx:{color:"secondary",mt:3,a:{color:"secondary"},fontSize:[1,1,2]}},(0,l.tZ)("time",null,n.date),n.tags&&(0,l.tZ)(a.Fragment,null," — ",(0,l.tZ)(o.Z,{tags:n.tags})),n.timeToRead&&" — ",n.timeToRead&&(0,l.tZ)("span",null,n.timeToRead," min read")),(0,l.tZ)("section",{sx:{my:5,".gatsby-resp-image-wrapper":{my:[4,4,5],borderRadius:"4px",boxShadow:m.join(", "),".gatsby-resp-image-image":{borderRadius:"4px"}},variant:"layout.content"}},t),(0,l.tZ)(i,{post:n}))};const p=e=>{var n,t,a;let{data:{post:r}}=e;return(0,l.tZ)(s.Z,{title:r.title,description:r.description?r.description:r.excerpt,image:r.banner?null===(n=r.banner)||void 0===n||null===(t=n.childImageSharp)||void 0===t||null===(a=t.resize)||void 0===a?void 0:a.src:void 0,pathname:r.slug,canonicalUrl:r.canonicalUrl})};function d(e){let{...n}=e;return a.createElement(u,n)}},6799:function(e,n,t){var a=t(8733),l=t(7294),r=t(1883),c=t(3494),o=t(9706);n.Z=e=>{let{tags:n}=e;const{tagsPath:t,basePath:s}=(0,c.Z)();return(0,a.tZ)(l.Fragment,null,n.map(((e,n)=>(0,a.tZ)(l.Fragment,{key:e.slug},!!n&&", ",(0,a.tZ)(r.Link,{sx:e=>{var n;return{...null===(n=e.styles)||void 0===n?void 0:n.a}},to:(0,o.Z)(`/${s}/${t}/${e.slug}`)},e.name)))))}},8871:function(e,n,t){var a=t(7294),l=t(1883),r=t(4232);n.Z=e=>{let{title:n="",description:t="",pathname:c="",image:o="",children:s=null,canonicalUrl:i=""}=e;const m=(0,r.Z)(),{siteTitle:u,siteTitleAlt:p,siteUrl:d,siteDescription:g,siteImage:h,author:A,siteLanguage:b}=m,E={title:n?`${n} | ${u}`:p,description:t||g,url:`${d}${c||""}`,image:`${d}${o||h}`};return a.createElement(a.Fragment,null,a.createElement("html",{lang:b}),a.createElement("title",null,E.title),a.createElement("meta",{name:"description",content:E.description}),a.createElement("meta",{name:"image",content:E.image}),a.createElement("meta",{property:"og:title",content:E.title}),a.createElement("meta",{property:"og:url",content:E.url}),a.createElement("meta",{property:"og:description",content:E.description}),a.createElement("meta",{property:"og:image",content:E.image}),a.createElement("meta",{property:"og:type",content:"website"}),a.createElement("meta",{property:"og:image:alt",content:E.description}),a.createElement("meta",{name:"twitter:card",content:"summary_large_image"}),a.createElement("meta",{name:"twitter:title",content:E.title}),a.createElement("meta",{name:"twitter:url",content:E.url}),a.createElement("meta",{name:"twitter:description",content:E.description}),a.createElement("meta",{name:"twitter:image",content:E.image}),a.createElement("meta",{name:"twitter:image:alt",content:E.description}),a.createElement("meta",{name:"twitter:creator",content:A}),a.createElement("meta",{name:"gatsby-theme",content:"@lekoarts/gatsby-theme-minimal-blog"}),a.createElement("link",{rel:"icon",type:"image/png",sizes:"32x32",href:(0,l.withPrefix)("/favicon-32x32.png")}),a.createElement("link",{rel:"icon",type:"image/png",sizes:"16x16",href:(0,l.withPrefix)("/favicon-16x16.png")}),a.createElement("link",{rel:"apple-touch-icon",sizes:"180x180",href:(0,l.withPrefix)("/apple-touch-icon.png")}),i?a.createElement("link",{rel:"canonical",href:i}):null,s)}},7789:function(e,n,t){t.r(n),t.d(n,{Head:function(){return o.F},default:function(){return s}});var a=t(7294),l=t(1151);function r(e){const n=Object.assign({h1:"h1",h2:"h2",pre:"pre",code:"code",p:"p",h3:"h3",ul:"ul",li:"li",h4:"h4",strong:"strong",h5:"h5",em:"em",span:"span"},(0,l.ah)(),e.components);return a.createElement(a.Fragment,null,a.createElement(n.h1,null,"Recon"),"\n",a.createElement(n.h2,null,"Nmap"),"\n",a.createElement(n.pre,null,a.createElement(n.code,null,"nmap -v -A -oA nmap/forest 10.10.10.161\n")),"\n",a.createElement(n.h2,null,"Ping"),"\n",a.createElement(n.pre,null,a.createElement(n.code,null,"ping 10.10.10.161\n")),"\n",a.createElement(n.p,null,"Ping tool suggests the box is windows as it has a ttl of 127."),"\n",a.createElement(n.h3,null,"Standard TTLs"),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,"Linux default ttl is 64"),"\n",a.createElement(n.li,null,"Windows default ttl is 128 (-1 for router)"),"\n",a.createElement(n.li,null,"Routers or network devices are 255 (usually above 128)"),"\n"),"\n",a.createElement(n.h2,null,"DNS"),"\n",a.createElement(n.pre,null,a.createElement(n.code,null,"nslookup \n> server 10.10.10.161\n> 127.0.0.1\n> 127.0.0.2\n> 10.10.10.161\n\n")),"\n",a.createElement(n.p,null,"Maybe some DNS recursion or some issue which is stopping us from getting hostname"),"\n",a.createElement(n.h2,null,"Ports/Services"),"\n",a.createElement(n.h4,null,"445"),"\n",a.createElement(n.p,null,"Usually used for Microsoft Directory Services for Active Directory and for ",a.createElement(n.strong,null,"Server Message Block (SMB)")," protocol over TCP/IP"),"\n",a.createElement(n.h5,null,"smb"),"\n",a.createElement(n.p,null,"Host script results shows that it is running smb"),"\n",a.createElement(n.p,null,"Let's try smbclient first using -L flag"),"\n",a.createElement(n.p,null,a.createElement(n.code,null,"-L")," This option allows you to look at what services are available on a server. You use it as smbclient -L host and a list should appear. The -I option may be useful if your NetBIOS names don't match your TCP/IP DNS host names or if you are trying to reach a host on another network."),"\n",a.createElement(n.pre,null,a.createElement(n.code,null,"smbclient -L 10.10.10.161\n")),"\n",a.createElement(n.p,null,"Looks like nothing is available"),"\n",a.createElement(n.h4,null,"LDAP - getting users and password spraying"),"\n",a.createElement(n.p,null,"LDAP seems like another service with a decent attack surface"),"\n",a.createElement(n.p,null,"We can get the DN (domain name) from using ",a.createElement(n.code,null,"ldapsearch")," (namingContexts)"),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,"the machine [[Ypuffy]] explains this better"),"\n"),"\n",a.createElement(n.pre,null,a.createElement(n.code,null,"ldapsearch -x -s base -H ldap://10.10.10.161\n")),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,a.createElement(n.code,null,"-x"),": Use simple authentication instead of SASL."),"\n",a.createElement(n.li,null,a.createElement(n.code,null,"-s"),": ",a.createElement(n.code,null,"base"),"|one|sub|children"),"\n"),"\n",a.createElement(n.p,null,"Specify the scope of the search to be one of:"),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,a.createElement(n.code,null,"base"),", ",a.createElement(n.code,null,"one"),", ",a.createElement(n.code,null,"sub"),", or ",a.createElement(n.code,null,"children")," to specify a base object, one-level, subtree, or children search."),"\n",a.createElement(n.li,null,"The default is ",a.createElement(n.code,null,"sub"),"."),"\n"),"\n",a.createElement(n.p,null,"Note: ",a.createElement(n.em,null,"children")," scope requires LDAPv3 subordinate feature extension"),"\n",a.createElement(n.p,null,"From the command, we now know the base domain name to be ",a.createElement(n.code,null,"DC=htb,DC=local")),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,a.createElement(n.code,null,"-b")," basedn, basedn for search"),"\n",a.createElement(n.li,null,a.createElement(n.code,null,"DC")," = domain component\n",a.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 892px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 50.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABDklEQVR42p2S2W6DQAxF+Qv2sAUISGEnLBL//1mujqWhtEqltg9XY8+g42tsK8syCYJAPM9T+b6v+p7/VlZVVVIUhSZhGCocERuZgq7rqkz8rqBV17Xs+y6v10umaZLn8ylN08g8z5r3fS/DMEiappIkicRxrCcCcC2iwMfjIdu2ybquMo6jAtu2lWVZtAhgxBsncGKK0d39fpc8zyWKIoWeQAB8hDuA3CGgyAANHOEeKF3iXIFcHMdxtg2s67rTNeKNYryTE2MAM7Zti+M4ny3z07FLBU4j7m+325c3kxuRmyGeQ6F//gvOyrJU+2aq1/V5px/XhpYYBjBWiN386/6dQNoByhrg8LqX/wF+AMCcG8/bTGyKAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="ldap1"\n        title=""\n        src="/static/8cdc177d6103c748bb4c2dd74be452fe/aff63/ldap1.png"\n        srcset="/static/8cdc177d6103c748bb4c2dd74be452fe/5243c/ldap1.png 240w,\n/static/8cdc177d6103c748bb4c2dd74be452fe/ab158/ldap1.png 480w,\n/static/8cdc177d6103c748bb4c2dd74be452fe/aff63/ldap1.png 892w"\n        sizes="(max-width: 892px) 100vw, 892px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>'}})),"\n"),"\n",a.createElement(n.pre,null,a.createElement(n.code,null,'ldapsearch -H ldap://10.10.10.161 -x -b "DC=htb,DC=local" > ldap-anonymous.out\n')),"\n",a.createElement(n.p,null,"This includes all the LDAP information that we can query"),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,"we can get the groups by grep for memberof"),"\n"),"\n",a.createElement(n.pre,null,a.createElement(n.code,null,"cat ldap-anonymous.out | grep -i memberof\n")),"\n",a.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 63.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfklEQVR42mWSaa6CUAyF2YUIGg3gFBUVnAcMYf9rqvn6cvCa96Npe297ejpEdV3barWy3W5nZVn2er1e23a7dY1fFIWNx2ObTqc2mUxcRqORDYdDS9O0l6jrOtvv9/Z4POz5fNr7/Xb7er3a/X53jX86nexyubiPfT6f7XA4OBnAkyT5A+QDFnzC7ng8egFYVVXl79hiQ6I0ALz/MGzb1hNut5szQmACC9hQEKEYQjFGQY5GlGXZlyFABIRtiG2o+YMxQhfqhB3QYQ/4er16QGZFIEEkwhRfWgCAo/HJI1/LiVgE1AmiRbEgARBsErHVQcgSP8/zL0NmttlsPIgEKhKIRgRAARUUGP/khqfjSyFJC2AEWgTs1e5sNrPlcmnz+byXxWLh9/mzZRJ12Ihmw1zCrXLQg8HA4jh2LcFXu/1hw5CFNE3jZ8PmKYQWc94pAHh4NowAQv8OG2bMhCAKKFFMNUstKDz6sO0IZgxW56Ht6kTCrQOgd9kUY74C/ABHzY3efU1dTgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="ldap2"\n        title=""\n        src="/static/75ffa70c17827a0fc1ec981731b41313/7d769/ldap2.png"\n        srcset="/static/75ffa70c17827a0fc1ec981731b41313/5243c/ldap2.png 240w,\n/static/75ffa70c17827a0fc1ec981731b41313/ab158/ldap2.png 480w,\n/static/75ffa70c17827a0fc1ec981731b41313/7d769/ldap2.png 960w,\n/static/75ffa70c17827a0fc1ec981731b41313/ccea8/ldap2.png 1218w"\n        sizes="(max-width: 960px) 100vw, 960px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>'}}),"\n",a.createElement(n.p,null,"The followind command will dump only the things that have the objectClass as Person"),"\n",a.createElement(n.pre,null,a.createElement(n.code,null,"ldasearch -H ldap://10.10.10.161 -x -b \"DC=htb,DC=local\" '(objectClass=Person)'\n")),"\n",a.createElement(n.p,null,"From this we notice that the account name is sAMAccountName so we can apply a filter to ldapsearch\n",a.createElement(n.code,null,"ldapsearch -H ldap://10.10.10.161 -x -b \"DC=htb,DC=local\" '(objectClass=Person)' sAMAccountName | grep sAMAccountName > ldap-account-name.out")),"\n",a.createElement(n.p,null,a.createElement(n.code,null,"cat ldap-account-name.out")),"\n",a.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 384px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 51.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABe0lEQVR42mWSV4oDQQxE9xS2cc454pxzThh8/6vU8grGa9iPZqbV6tJTqX9isZiKxaIGg4E6nY7y+bxKpZJXo9FwrFqtemUyGaXTadXrde/L5bIqlYq/5KP1E4/HtV6v9X6/9Xg8NJlMvD8ej1qtVno+n3q9Xjqfz77YbDYdu1wuOp1OBjkcDr5jwYCw1+up1WqZkH2hUDAJhAFFMplUNpv1GYs8uoA6FAr9ES4WC1Ncr1eNRiMtl0vt93vHiUEEMcKIbDabTx73ut2uwuGw0DIhidPp1JRcCDxpt9tuCYparaZUKuUOaJtuEomEyaLRqOk+hLPZzCRQDIdDzedz7XY7F8Gf2+1mYgpRhH/8o23E0PgIBoSI9vt95XI5Uwb+EAumjIfBGYRM/ZvOgmBDxNSgYcp4AyEeQn2/301F4fF4rO126zNsiUQi/wnxBxGSqQ4NMdojxjcgYvEPPXkA/fOQavgEDYS8v2DKvD/eJ/QQMhD8pivsYFDfgr/vnTe2bALTxAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="ldap2"\n        title=""\n        src="/static/9392533a061f5a3155b44fa06fbb5235/643d6/ldap3.png"\n        srcset="/static/9392533a061f5a3155b44fa06fbb5235/5243c/ldap3.png 240w,\n/static/9392533a061f5a3155b44fa06fbb5235/643d6/ldap3.png 384w"\n        sizes="(max-width: 384px) 100vw, 384px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>'}}),"\n",a.createElement(n.p,null,"As we can see there are users called sebastien, lucinda, andy, mark and santi. There are also other accounts:"),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,a.createElement(n.code,null,"Guest")," cannot be bruteforced"),"\n",a.createElement(n.li,null,"anything with $ at the end, like ",a.createElement(n.code,null,"FOREST$")," and ",a.createElement(n.code,null,"EXCH01$")," is generated by AD as a machine account and the password cannot be cracked"),"\n",a.createElement(n.li,null,"then the rest are generated by exchange and won't be cracked"),"\n",a.createElement(n.li,null,"left with the last 5 entries"),"\n"),"\n",a.createElement(n.h5,null,"Format"),"\n",a.createElement(n.p,null,"We only need these account names so lets awk $2 and delete everything before sebastien manually."),"\n",a.createElement(n.pre,null,a.createElement(n.code,null,"cat ldap-account-name.out | awk '{print $2}' > accounts.out\n")),"\n",a.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 206px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 90.29126213592234%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB5klEQVR42p1Ux6pqQRD0D8w55xxQUFTMCCLGhRhwoWDYqCj+P3WphiP6DNf7Fn0m9JmamuqaUdntdijhcrmkDYfDCAaDt3n2ORcIBOB0OuU/t9sNm82G+/UMFT9WqxV+vx+z2QybzQbH4xGn0wmr1Qrb7RbT6RT9fh+dTkfmmB+NRk9gN0DuxJ2LxSJqtRrK5TLa7bb06/U6crkcksmk5KvVKkqlElKplKz5l6XqfqDX66HT6aTVaDTS12q1MlZyBoMBJpMJFovlPUOGw+EQRqFQSPSKxWLIZrOIx+PChrlIJCLa8V/GW0AmuWOr1cJyuRSdBoMBxuOx6Lfb7XA+n3G9XpHJZIThR0BFR1YxnU4LO7KhbqwwI5FISO5ddV9qaDQabxoqmprNZnEBW8YnsIcqezweDIdDOWKv1xP7NBoNRKNRkeOTbi996PP5sFgsMJlMxHPsr9drmWf+N6CXGvLItAVbCk/WfwF70lAxKkGUYvym2ROgYhkuvlwuEjwur+HhcBBfcoNv9HsoCu3Aq0X/0cQ0d6FQkI3+W0NaRq1Wy7Wjlhz/hd0DQz5JZJTP5+XyVyoVNJtNmaPR6cGvbUNA2mM+n2O/34t29GO32xULUQIy/hrw/oH1er23h5YA1FYZf3PkH16ABNBrceqFAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="format"\n        title=""\n        src="/static/96ae66830984169e26a2568a31bb9fb3/8904d/format.png"\n        srcset="/static/96ae66830984169e26a2568a31bb9fb3/8904d/format.png 206w"\n        sizes="(max-width: 206px) 100vw, 206px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>'}}),"\n",a.createElement(n.h1,null,"Tools"),"\n",a.createElement(n.h2,null,"CRACKMAPEXEC"),"\n",a.createElement(n.p,null,"Using crackmapexec we can dump the password policy of Active Directory using a null authentication, then doing a password spray since we now have a better idea of what the password looks like"),"\n",a.createElement(n.p,null,"Null authentication request with null username and password"),"\n",a.createElement(n.pre,null,a.createElement(n.code,null,"crackmapexec smb 10.10.10.161 --pass-pol -u '' -p ''\n")),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,"Using the option ",a.createElement(n.strong,null,"--pass-pol")," you can get the password policy of the domain"),"\n"),"\n",a.createElement(n.h2,null,"Enum4Linux (also gives password policy)"),"\n",a.createElement(n.p,null,"We'll run enum4linux which is a tool for enumerating information from Windows and Samba systems. It’s a wrapper around the ",a.createElement(n.strong,null,"Samba tools smbclient, rpclient, net and nmblookup"),". With special configuration, you can even have it query ",a.createElement(n.strong,null,"LDAP")),"\n",a.createElement(n.p,null,a.createElement(n.strong,null,"Check for null and Guest access on smb services")," (this won't work on modern Windows versions), it only works on Windows systems that have been upgraded from older versions as this was required in older versions"),"\n",a.createElement(n.pre,null,a.createElement(n.code,null,'enum4linux -a -u "" -p "" 10.10.10.161 && enum4linux -a -u "guest" -p "" 10.10.10.161\n')),"\n",a.createElement(n.p,null,"Using this tool  a user that we did not have before from ldapsearch can be seen called ",a.createElement(n.code,null,"svc-alfresco"),"\nAdd this user to the userlist we made before password spraying"))}var c=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,l.ah)(),e.components);return n?a.createElement(n,e,a.createElement(r,e)):r(e)},o=t(4765);function s(e){return a.createElement(o.Z,e,a.createElement(c,e))}o.Z}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-forest-index-mdx-883ea35093e29d33db28.js.map